var A=Object.defineProperty;var B=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var $=(t,l,s)=>l in t?A(t,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[l]=s,D=(t,l)=>{for(var s in l||(l={}))L.call(l,s)&&$(t,s,l[s]);if(B)for(var s of B(l))z.call(l,s)&&$(t,s,l[s]);return t};var V=(t,l,s)=>new Promise((C,o)=>{var d=c=>{try{u(s.next(c))}catch(v){o(v)}},x=c=>{try{u(s.throw(c))}catch(v){o(v)}},u=c=>c.done?C(c.value):Promise.resolve(c.value).then(d,x);u((s=s.apply(t,l)).next())});import{i as G,a as w,M as H,c as q,w as M,e as J,f as r,j as p,v as n,I as f,n as m,x as g,$ as k,F as I,E as R,k as _,q as O,l as b,t as N}from"./frappe-ui-63c927c1.js";import K from"./FormField-2f859ee8.js";import{_ as P}from"./index-1774bd7d.js";import Q from"./CustomIonModal-ca5ae48a.js";import{c as W}from"./claims-67ad6e81.js";import{f as F}from"./formatters-23b4eedd.js";const X={class:"flex flex-row justify-between items-center mt-2"},Y=n("h2",{class:"text-base font-semibold text-gray-800"},"Expenses",-1),Z={class:"flex flex-row gap-3 items-center"},ee={class:"text-base font-semibold text-gray-800"},te={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},se=["onClick"],ae={class:"flex flex-col w-full justify-center gap-2.5"},ne={class:"flex flex-row items-center justify-between"},le={class:"flex flex-row items-start gap-3 grow"},oe={class:"flex flex-col items-start gap-1.5"},ie={class:"text-base font-normal text-gray-800"},de={class:"text-xs font-normal text-gray-500"},re=n("span",{class:"whitespace-pre"}," Â· ",-1),ce={key:0,class:"whitespace-nowrap"},ue={class:"flex flex-row justify-end items-center gap-2"},me={class:"text-gray-700 font-normal rounded text-base"},pe={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},fe={class:"w-full pt-8 pb-5 border-b text-center"},xe={class:"text-gray-900 font-bold text-lg"},ve={class:"w-full flex flex-col items-center justify-center gap-5 p-4"},ye={class:"flex flex-col w-full space-y-4"},_e={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Ie={__name:"ExpensesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-item","update-expense-item","delete-expense-item"],setup(t,{emit:l}){const s=t,C=G("$dayjs"),o=w({}),d=w(null),x=w(!1),u=w(!1),c=(i,a)=>V(this,null,function*(){i&&(o.value=D({},i),d.value=a),u.value=!0,x.value=!0}),v=()=>{l("delete-expense-item",d.value),j()},T=()=>{d.value===null?l("add-expense-item",o.value):l("update-expense-item",o.value,d.value),j()};function j(){u.value=!1,x.value=!1,o.value={},d.value=null}const E=H({url:"wms.api.get_doctype_fields",params:{doctype:"Expense Claim Detail"},transform(i){const a=["description_sb","amounts_sb"],y=["cost_center","project","branch","accounting_dimensions_section"];return s.id||a.push(...y),i.filter(e=>!a.includes(e.fieldname))}});E.reload();const S=q(()=>s.isReadOnly?"Expense Item":d.value===null?"New Expense Item":"Edit Expense Item"),U=q(()=>{var i;return(i=E.data)==null?void 0:i.some(a=>{if(a.reqd&&!o.value[a.fieldname])return!0})});return M(()=>o.value.expense_type,i=>{var a;o.value.description||(o.value.description=(a=W[i])==null?void 0:a.description),o.value.cost_center=s.expenseClaim.cost_center}),M(()=>o.value.amount,i=>{u.value?u.value=!1:o.value.sanctioned_amount=parseFloat(i)}),(i,a)=>{const y=J("Button");return r(),p(I,null,[n("div",X,[Y,n("div",Z,[n("span",ee,f(m(F)(t.expenseClaim.total_claimed_amount,t.currency)),1),t.isReadOnly?k("",!0):(r(),g(y,{key:0,id:"add-expense-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:a[0]||(a[0]=e=>c())}))])]),t.expenseClaim.expenses?(r(),p("div",te,[(r(!0),p(I,null,R(t.expenseClaim.expenses,(e,h)=>(r(),p("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:h,onClick:be=>c(e,h)},[n("div",ae,[n("div",ne,[n("div",le,[n("div",oe,[n("div",ie,f(e.expense_type),1),n("div",de,[n("span",null," Sanctioned: "+f(m(F)(e.sanctioned_amount,t.currency)),1),re,e.expense_date?(r(),p("span",ce,f(m(C)(e.expense_date).format("D MMM")),1)):k("",!0)])])]),n("div",ue,[n("span",me,f(m(F)(e.amount,t.currency)),1),_(m(O),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,se))),128))])):(r(),g(P,{key:1,message:"No expenses added",isTableField:!0})),_(Q,{isOpen:x.value,onDidDismiss:a[3]||(a[3]=e=>j())},{actionSheet:b(()=>[n("div",pe,[n("div",fe,[n("span",xe,f(S.value),1)]),n("div",ve,[n("div",ye,[(r(!0),p(I,null,R(m(E).data,e=>(r(),g(K,{key:e.fieldname,class:"w-full",label:e.label,fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,hidden:e.hidden,reqd:e.reqd,default:e.default,readOnly:e.read_only||t.isReadOnly,modelValue:o.value[e.fieldname],"onUpdate:modelValue":h=>o.value[e.fieldname]=h},null,8,["label","fieldtype","fieldname","options","hidden","reqd","default","readOnly","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?k("",!0):(r(),p("div",_e,[d.value!==null?(r(),g(y,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:a[1]||(a[1]=e=>v())},{prefix:b(()=>[_(m(O),{name:"trash",class:"w-4"})]),default:b(()=>[N(" Delete ")]),_:1})):k("",!0),_(y,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:a[2]||(a[2]=e=>T()),disabled:U.value},{prefix:b(()=>[_(m(O),{name:d.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[N(" "+f(d.value===null?"Add Expense":"Update Expense"),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)}}};export{Ie as default};
