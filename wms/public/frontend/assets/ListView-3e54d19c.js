var oe=Object.defineProperty,se=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var j=(s,e,a)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,D=(s,e)=>{for(var a in e||(e={}))le.call(e,a)&&j(s,a,e[a]);if(N)for(var a of N(e))re.call(e,a)&&j(s,a,e[a]);return s},M=(s,e)=>se(s,ae(e));var H=(s,e,a)=>new Promise(($,C)=>{var F=n=>{try{p(a.next(n))}catch(u){C(u)}},m=n=>{try{p(a.throw(n))}catch(u){C(u)}},p=n=>n.done?$(n.value):Promise.resolve(n.value).then(F,m);p((a=a.apply(s,e)).next())});import{G as I,C as ne,A as P,a as ie,r as w,B as R,R as ue,I as ce,q as de,E as T,o as h,i as x,g as l,w as f,d as _,u as r,x as U,t as fe,n as me,e as pe,a2 as ve,aL as ge,aM as ye,F as z,j as we,b as K,K as he,f as W,aN as _e,a3 as be,a1 as G,aK as ke}from"./index-c4230fc7.js";import xe from"./TabButtons-23fbfbd6.js";import Ce from"./LeaveRequestItem-6b4ee68b.js";import Fe from"./ExpenseClaimItem-fdc25794.js";import Be from"./EmployeeAdvanceItem-07f4da13.js";import Se from"./ListFiltersActionSheet-325f1bcf.js";import Re from"./CustomIonModal-cfae22b1.js";import{u as $e}from"./RequestList-7cef86bf.js";import{u as Ve}from"./realtime-1b832505.js";/* empty css                                                   */import"./Badge.vue_vue_type_script_setup_true_lang-1668e2d0.js";import"./EmployeeAvatar-266dc3d2.js";import"./notifications-765e05d1.js";import"./LeaveIcon-a78a48d2.js";import"./leaves-8e583431.js";import"./ExpenseIcon-a89faa9d.js";import"./RequestActionSheet.vue_vue_type_style_index_0_scoped_5369b918_lang-896a1073.js";import"./formatters-34ed679f.js";import"./EmployeeAdvanceIcon-d6a56cbc.js";import"./FormField-322c2c84.js";import"./ErrorMessage-5160fa56.js";const qe={class:"w-full sm:w-96"},Ie={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},Te={class:"flex flex-row items-center"},Ae={class:"text-xl font-semibold text-gray-900"},Ee={class:"flex flex-row gap-2"},Le={class:"w-full mt-5"},Ne={key:0,class:"flex flex-col bg-white rounded mt-5"},je={key:2,class:"flex mt-2 items-center justify-center"},nt={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!0},pageTitle:{type:String,required:!0}},setup(s){const e=s,a={"Leave Application":I(Ce),"Expense Claim":I(Fe),"Employee Advance":I(Be)},$=ne(),C=P("$socket"),F=P("$employee"),m=ie({}),p=w(e.tabButtons[0]),n=w(!1),u=w([]),B=w(null),A=w(null),V=w(!0),S=w({doctype:e.doctype,fields:e.fields,group_by:e.groupBy,order_by:`\`tab${e.doctype}\`.modified desc`,page_length:50}),E=R(()=>p.value===e.tabButtons[1]),O=R(()=>`${e.doctype.replace(/\s+/g,"")}FormView`),J=R(()=>`${e.doctype.replace(/\s+/g,"")}DetailView`),Q=R(()=>{const t=[];return E.value?t.push([e.doctype,"employee","!=",F.data.name]):t.push([e.doctype,"employee","=",F.data.name]),t}),c=ue({url:"frappe.desk.reportview.get",onSuccess:t=>{var o;((o=t.values)==null?void 0:o.length)<S.value.page_length&&(V.value=!1)},transform(t){if(t.length===0)return[];const o=t.keys,b=t.values.map(y=>{const k={};return o.forEach((i,q)=>{k[i]=y[q]}),k});let g;return!c.params.start||c.params.start===0?g=b:g=c.data.concat(b),g}});function L(){e.filterConfig.forEach(t=>{m[t.fieldname]={condition:"=",value:null}}),u.value=[]}L();function X(){let t="",o="";u.value=[];for(const d in m)t=m[d].condition,typeof t=="object"&&t!==null&&(t=t.value),o=m[d].value,t&&o&&u.value.push([e.doctype,d,t,o])}function Y(){X(),v(),G.dismiss(),n.value=!!u.value.length}function Z(){L(),v(),G.dismiss(),n.value=!1}function v(t=0){t===0&&(V.value=!0);const o=[[e.doctype,"docstatus","!=","2"]];o.push(...Q.value),u.value&&o.push(...u.value),B.value&&S.value.fields.push(B.value),c.submit(M(D({},S.value),{start:t||0,filters:o}))}const ee=ke(()=>{if(!V.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:d}=A.value;if(t/(o-d)*100>=90){const g=c.params.start+S.value.page_length;v(g)}},500),te=t=>{setTimeout(()=>{v(),t.target.complete()},500)};return ce(()=>p.value,t=>{v()}),de(()=>H(this,null,function*(){const t=$e(e.doctype);yield t.workflowDoc.promise,B.value=t.getWorkflowStateField(),v(),Ve(C,e.doctype,()=>v())})),(t,o)=>{const d=T("Button"),b=T("router-link"),g=T("EmptyState");return h(),x(z,null,[l(r(ve),{class:"ion-no-border"},{default:f(()=>[_("div",qe,[_("div",Ie,[_("div",Te,[l(d,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:o[0]||(o[0]=y=>r($).back())},{default:f(()=>[l(r(U),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),_("h2",Ae,fe(s.pageTitle),1)]),_("div",Ee,[l(d,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:me([n.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),l(b,{to:{name:O.value}},{default:f(({navigate:y})=>[l(d,{variant:"solid",class:"mr-2",onClick:y},{prefix:f(()=>[l(r(U),{name:"plus",class:"w-4"})]),default:f(()=>[pe(" New ")]),_:2},1032,["onClick"])]),_:1},8,["to"])])])])]),_:1}),l(r(be),null,{default:f(()=>{var y,k;return[l(r(ge),{slot:"fixed",onIonRefresh:o[1]||(o[1]=i=>te(i))},{default:f(()=>[l(r(ye))]),_:1}),_("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:A,onScroll:o[3]||(o[3]=()=>r(ee)())},[_("div",Le,[l(xe,{buttons:[{label:s.tabButtons[0]},{label:s.tabButtons[1]}],modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=i=>p.value=i)},null,8,["buttons","modelValue"]),!r(c).loading&&((y=r(c).data)!=null&&y.length)?(h(),x("div",Ne,[(h(!0),x(z,null,we(r(c).data,i=>(h(),x("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:i.name},[l(b,{to:{name:J.value,params:{id:i.name}}},{default:f(({navigate:q})=>[(h(),K(he(a[s.doctype]),{doc:i,isTeamRequest:E.value,workflowStateField:B.value,onClick:q},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"])]))),128))])):r(c).loading?W("",!0):(h(),K(g,{key:1,message:`No ${(k=e.doctype)==null?void 0:k.toLowerCase()}s found`},null,8,["message"])),r(c).loading?(h(),x("div",je,[l(r(_e),{class:"w-8 h-8 text-gray-800"})])):W("",!0)])],544),l(Re,{trigger:"show-filter-modal"},{actionSheet:f(()=>[l(Se,{filterConfig:s.filterConfig,onApplyFilters:Y,onClearFilters:Z,filters:m,"onUpdate:filters":o[4]||(o[4]=i=>m=i)},null,8,["filterConfig","filters"])]),_:1})]}),_:1})],64)}}};export{nt as default};
