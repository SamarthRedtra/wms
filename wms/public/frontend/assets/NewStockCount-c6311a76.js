var ke=Object.defineProperty;var G=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var X=(p,r,n)=>r in p?ke(p,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):p[r]=n,Y=(p,r)=>{for(var n in r||(r={}))xe.call(r,n)&&X(p,n,r[n]);if(G)for(var n of G(r))Se.call(r,n)&&X(p,n,r[n]);return p};var f=(p,r,n)=>new Promise((q,y)=>{var I=c=>{try{E(n.next(c))}catch(A){y(A)}},m=c=>{try{E(n.throw(c))}catch(A){y(A)}},E=c=>c.done?q(c.value):Promise.resolve(c.value).then(I,m);E((n=n.apply(p,r)).next())});import{m as Ce,r as s,H as Z,I as ee,B as te,P as Re,q as Ne,b as ae,w as qe,u as k,o as l,d as o,s as N,Q as oe,i as d,j as O,t as w,F as B,g as S,x as C,z as Ie,v as V,e as Ee,f as se,K as Ae}from"./index-03cc7949.js";import Qe from"./BaseLayout-33181b3c.js";import{Q as P}from"./quagga.min-76816692.js";import{a as R}from"./axios-fc3df026.js";import{u as De}from"./index-192d3f78.js";import"./notifications-9b74206f.js";const Le={class:"flex flex-col items-center"},Oe=o("p",null,"Purpose",-1),Be=o("option",{value:""},null,-1),Pe=o("option",{value:"Opening Stock"},"Opening Stock",-1),Ue=o("option",{value:"Stock Reconciliation"},"Stock Reconciliation",-1),$e=[Be,Pe,Ue],je=o("p",null,"Company",-1),ze=["value"],Me={id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},Ve=o("p",null,"Stock Entries",-1),Te={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},Fe={class:"flex flex-col bg-white rounded"},Je=["onClick"],We={class:"flex flex-row items-center gap-3 grow"},He={class:"text-xs font-normal text-gray-800 leading-6"},Ke={id:"circleii"},Ge={id:"reader"},Xe={key:0,class:"add-form"},Ye=o("br",null,null,-1),Ze=o("label",{for:"itemName"},"Item",-1),et={class:"barcode-input"},tt={id:"searchName"},at=["value"],ot=o("br",null,null,-1),st=o("label",{for:"itemName"},"Warehouse",-1),nt={class:"barcode-input"},rt={id:"searchWarehouse"},lt=["value"],ct=o("br",null,null,-1),it=o("label",{for:"itemName"},"Quantity",-1),ut=o("br",null,null,-1),dt=o("br",null,null,-1),mt=o("div",{id:"barcodeScanner"},null,-1),vt=[mt],pt={class:"flex flex-col gap-5 my-4 w-full"},ht={class:"flex flex-col bg-white rounded"},_t={class:"flex flex-row items-center gap-3 grow"},ft={class:"text-sm font-normal text-gray-800 leading-6"},yt={id:"circleii"},qt={__name:"NewStockCount",setup(p){const{cookies:r}=De(),n=Ce(),q=s("");q.value=n.query.linkName,s(!1);const y=s(!1);s("");const I=s(!1),m=s({}),E=t=>{m.value=Y({},t),h.value=t.itemCode,g.value=t.warehouse,v.value=t.quantity,y.value=!0},c=()=>f(this,null,function*(){y.value=!1,L.value=!1}),A=()=>f(this,null,function*(){y.value=!1,I.value=!0;try{yield ne(),re()}catch(t){console.error("Error loading Quagga:",t)}}),ne=()=>new Promise((t,a)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=t,e.onerror=a,document.head.appendChild(e)}),re=()=>{P.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(t){if(t){console.error(t);return}P.start()})},le=()=>{I.value=!1,P&&P.stop&&P.stop()},T=()=>{y.value=!y.value,L.value=!1},ce=()=>{window.location.href="/StockCount"};Z({doctype:"Purchase Order",fields:["*"],auto:!0});const ie=Z({doctype:"Warehouse",fields:["*"],auto:!0}),F=s([]);ee(()=>ie.data,t=>{if(t&&Array.isArray(t)){const a=t.filter(e=>e.is_group===0);F.value=a.map(e=>e.name)}});const h=s(""),g=s(""),v=s(0),ue=s(""),de=s(""),me=s([]),ve=s([]);s({});const j=s([]);(()=>f(this,null,function*(){try{const t=yield R.get("/api/method/wms.api.my_api.get_all_items");j.value=t.data.message,console.log("itemList data",j.value)}catch(t){console.error("Error fetching warehouse:",t)}}))();const z=s([]);(()=>f(this,null,function*(){try{const t=yield R.get("/api/method/wms.api.my_api.get_all_company");z.value=t.data.message,console.log("companyList data",z.value)}catch(t){console.error("Error fetching warehouse:",t)}}))(),ee(ue,t=>f(this,null,function*(){t&&(yield fetchItemData(t))}));const b=s([]),J=()=>{const t=h.value,a=g.value,e=Number(v.value),u=b.value.find(x=>x.itemCode===t&&x.warehouse===a);u?u.quantity+=e:b.value.push({itemCode:t,warehouse:a,quantity:e}),M()},W=()=>h.value.trim()!==""&&g.value.trim()!==""&&v.value!==null&&!isNaN(v.value)&&v.value>0,pe=()=>{if(W()){if(m.value.itemCode){const t=b.value.find(a=>a.itemCode===m.value.itemCode&&a.warehouse===m.value.warehouse);t&&(t.quantity=v.value,t.warehouse=g.value,t.itemCode=h.value)}else J();M(),m.value={}}},he=()=>{if(W()){if(m.value.itemCode){const t=b.value.find(a=>a.itemCode===m.value.itemCode&&a.warehouse===m.value.warehouse);t&&(t.quantity=v.value,t.warehouse=g.value,t.itemCode=h.value)}else J();M(),T(),m.value={}}},M=()=>{h.value="",v.value="",g.value="",de.value=""},_e=s([]);_e.value=ve.value,s("");let i=s("New");const Q=s(""),D=s(""),L=s(!1),U=s(""),fe=()=>{L.value=!0;const t=new Html5Qrcode("reader");t.start({facingMode:"environment"},a=>{console.log("QR code scanned:",a),alert("QR code scanned: "+a),K(U.value),H(t)},a=>{U.value=a,alert(" QR code: "+U.value),K(U.value),H(t)})},H=t=>{L.value=!1,t.stop()},$=s(""),K=t=>f(this,null,function*(){try{const a=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${t}`);if(!a.ok)throw new Error("Network response was not ok");const e=yield a.json();return $.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(a){return console.error("Error fetching item details:",a),null}}),ye=te(()=>{const t=new Set;return me.value.filter(a=>{const e=t.has(a.name);return t.add(a.name),!e})});te(()=>ye.value.some(t=>t.name===$.value)),Re(()=>{$.value&&(h.value=$.value)}),console.log("linkName",q);const _=s([]),ge=()=>f(this,null,function*(){try{const t=yield R.get("/api/method/wms.api.my_api.get_stock_by_name",{params:{name:q.value}});if(_.value=t.data.message,console.log("apiData",_.value),t.data&&t.data.message&&(D.value=_.value.purpose||"",Q.value=_.value.company||"",_.value.items&&_.value.items.length>0)){const a=_.value.items[0];h.value=a.item_code||"",g.value=a.warehouse||"",v.value=a.qty||""}_.value?(i.value=_.value.name,_.value.items.forEach(a=>{b.value.push({itemCode:a.item_code,warehouse:a.warehouse,quantity:a.qty})})):console.error("Invalid response data:",t.data)}catch(t){console.log("Error while fetching data",t.response)}});Ne(()=>{n.query.linkName&&ge()});const we=()=>f(this,null,function*(){const t=r.get("sid"),a={company:Q.value,purpose:D.value,items:b.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity})),docstatus:0};try{if(i.value&&i.value!=="New"){const e=yield R.put(`/api/resource/Stock Reconciliation/${i.value}`,a,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Reconciliation",e.data),alert("Updated Stock Reconciliation: "+e.data.data.name)}else{const e=yield R.post("/api/resource/Stock Reconciliation",a,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Reconciliation",e.data),i.value=e.data.data.name,alert("Created Stock Reconciliation: "+i.value)}}catch(e){console.error("Error in Stock Reconciliation process:",e);try{const u=JSON.parse(e.response.data._server_messages),x=JSON.parse(u[0]);alert(x.message)}catch(u){console.error("Error parsing server message:",u),alert("An unexpected error occurred.")}}}),be=()=>f(this,null,function*(){const t=r.get("sid"),a={company:Q.value,purpose:D.value,items:b.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity})),docstatus:1};try{if(i.value&&i.value!=="New"){const e=yield R.put(`/api/resource/Stock Reconciliation/${i.value}`,a,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Reconciliation",e.data),alert("Updated Stock Reconciliation: "+e.data.data.name)}else{const e=yield R.post("/api/resource/Stock Reconciliation",a,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Reconciliation",e.data),i.value=e.data.data.name,alert("Created Stock Reconciliation: "+i.value)}}catch(e){console.error("Error in Stock Reconciliation process:",e);try{const u=JSON.parse(e.response.data._server_messages),x=JSON.parse(u[0]);alert(x.message)}catch(u){console.error("Error parsing server message:",u),alert("An unexpected error occurred.")}}});return(t,a)=>(l(),ae(Qe,{pageTitle:k(i),home:"edit",onCartIconClick:ce,class:"text-xs"},{body:qe(()=>[o("div",Le,[o("div",{onClick:c,id:"containerIII",class:"flex justify-around text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[Oe,N(o("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e)},$e,512),[[oe,D.value]])]),o("div",{onClick:c,id:"containerII",class:"flex justify-around text-base leading-6 rounded w-full py-1 px-4 border-none"},[je,N(o("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>Q.value=e)},[(l(!0),d(B,null,O(z.value,e=>(l(),d("option",{key:e.name,value:e.name},w(e.name),9,ze))),128))],512),[[oe,Q.value]])]),o("div",Me,[Ve,S(k(C),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:T})]),o("div",Te,[o("div",Fe,[(l(!0),d(B,null,O(b.value,(e,u)=>(l(),d("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b cursor-pointer",key:u,onClick:x=>E(e)},[o("div",We,[S(k(C),{name:"edit",class:"h-5 w-5 text-gray-500"}),o("div",He,[o("p",null,w(e.itemCode)+" | "+w(e.warehouse),1)]),o("div",Ke,w(e.quantity),1)]),S(k(C),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,Je))),128))])]),N(o("div",Ge,null,512),[[Ie,L.value]]),y.value?(l(),d("div",Xe,[o("div",{onClick:c,id:"space"},[o("div",{onClick:c,id:"scrollerLine"})]),Ye,Ze,o("div",et,[N(o("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>h.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[V,h.value]]),o("datalist",tt,[(l(!0),d(B,null,O(j.value,e=>(l(),d("option",{key:e.name,value:e.name},w(e.name),9,at))),128))]),Ee(),o("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:fe},[S(k(C),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ot,st,o("div",nt,[N(o("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e)},null,512),[[V,g.value]]),o("datalist",rt,[(l(!0),d(B,null,O(F.value,e=>(l(),d("option",{key:e,value:e},w(e),9,lt))),128))]),o("span",{class:"barcode-scanner",onClick:A},[S(k(C),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ct,it,N(o("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>v.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[V,v.value]]),ut,o("button",{id:"addNew",onClick:pe},"Submit and Add New"),dt,o("button",{id:"sub",onClick:he},"Submit ")])):se("",!0),I.value?(l(),d("div",{key:1,class:"barcode-scanner-container",onClick:le},vt)):se("",!0),o("div",pt,[o("div",ht,[(l(!0),d(B,null,O(t.submittedData,e=>(l(),d("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[o("div",_t,[(l(),ae(Ae(e.icon),{class:"h-5 w-5 text-gray-500"})),S(k(C),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),o("div",ft,[o("p",null,w(e.itemCode)+"| "+w(e.warehouse),1)]),o("div",yt,w(e.quantity),1)]),S(k(C),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),o("div",{id:"btnDiv",class:"w-full flex justify-around sm:w-96 py-2 standalone:pb-safe-bottom"},[o("button",{id:"submitPurchaseReceipt",onClick:be},"Submit"),o("button",{id:"savePurchaseReceipt",onClick:we},"Save")])])]),_:1},8,["pageTitle"]))}};export{qt as default};
