var we=Object.defineProperty;var G=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var X=(v,n,r)=>n in v?we(v,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[n]=r,Y=(v,n)=>{for(var r in n||(n={}))be.call(n,r)&&X(v,r,n[r]);if(G)for(var r of G(n))xe.call(n,r)&&X(v,r,n[r]);return v};var _=(v,n,r)=>new Promise((N,g)=>{var M=l=>{try{I(r.next(l))}catch(E){g(E)}},d=l=>{try{I(r.throw(l))}catch(E){g(E)}},I=l=>l.done?N(l.value):Promise.resolve(l.value).then(M,d);I((r=r.apply(v,n)).next())});import{m as qe,r as o,H as Z,I as ee,B as ae,P as Ce,q as ke,b as te,w as Re,u as b,o as u,d as s,s as S,Q as Se,v as P,g as C,x as k,i as f,j as T,t as x,F as $,z as Ne,e as Me,f as se,K as Ie}from"./index-c4230fc7.js";import Ee from"./BaseLayout-e39ea2b2.js";import{Q as L}from"./quagga.min-da1f328f.js";import{a as R}from"./axios-fc3df026.js";import{u as De}from"./index-1210b84f.js";import"./notifications-765e05d1.js";const Ae={class:"flex flex-col items-center"},Qe=s("p",null,"Purpose",-1),Le=s("option",{value:"Material Transfer"},"Material Transfer",-1),Be=[Le],Oe=s("p",null,"RequiredDate",-1),Pe={id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},Te=s("p",null,"Material Requests",-1),$e={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},je={class:"flex flex-col bg-white rounded"},Ue=["onClick"],ze={class:"flex flex-row items-center gap-3 grow"},Ve={class:"text-xs font-normal text-gray-800 leading-6"},Fe={id:"circleii"},Je={id:"reader"},We={key:0,class:"add-form"},He=s("br",null,null,-1),Ke=s("label",{for:"itemName"},"Item",-1),Ge={class:"barcode-input"},Xe={id:"searchName"},Ye=["value"],Ze=s("br",null,null,-1),ea=s("label",{for:"itemName"},"Warehouse",-1),aa={class:"barcode-input"},ta={id:"searchWarehouse"},sa=["value"],oa=s("br",null,null,-1),ra=s("label",{for:"itemName"},"Quantity",-1),na=s("br",null,null,-1),la=s("br",null,null,-1),ia=s("div",{id:"barcodeScanner"},null,-1),ca=[ia],ua={class:"flex flex-col gap-5 my-4 w-full"},da={class:"flex flex-col bg-white rounded"},ma={class:"flex flex-row items-center gap-3 grow"},va={class:"text-sm font-normal text-gray-800 leading-6"},pa={id:"circleii"},Ca={__name:"NewMaterialRequest",setup(v){const{cookies:n}=De(),r=qe(),N=o("");N.value=r.query.linkName,o(!1);const g=o(!1);o("");const M=o(!1),d=o({}),I=a=>{d.value=Y({},a),p.value=a.itemCode,y.value=a.warehouse,m.value=a.quantity,g.value=!0},l=()=>_(this,null,function*(){g.value=!1,Q.value=!1}),E=()=>_(this,null,function*(){g.value=!1,M.value=!0;try{yield oe(),re()}catch(a){console.error("Error loading Quagga:",a)}}),oe=()=>new Promise((a,t)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=a,e.onerror=t,document.head.appendChild(e)}),re=()=>{L.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(a){if(a){console.error(a);return}L.start()})},ne=()=>{M.value=!1,L&&L.stop&&L.stop()},z=()=>{g.value=!g.value,Q.value=!1},le=()=>{window.location.href="/StockCount"};Z({doctype:"Purchase Order",fields:["*"],auto:!0});const ie=Z({doctype:"Warehouse",fields:["*"],auto:!0}),V=o([]);ee(()=>ie.data,a=>{if(a&&Array.isArray(a)){const t=a.filter(e=>e.is_group===0);V.value=t.map(e=>e.name)}});const p=o(""),y=o(""),m=o(0),ce=o(""),ue=o([]),de=o([]);o({});const j=o([]);(()=>_(this,null,function*(){try{const a=yield R.get("/api/method/wms.api.my_api.get_all_items");j.value=a.data.message,console.log("itemList data",j.value)}catch(a){console.error("Error fetching warehouse:",a)}}))();const F=o([]);(()=>_(this,null,function*(){try{const a=yield R.get("/api/method/wms.api.my_api.get_all_company");F.value=a.data.message,console.log("companyList data",F.value)}catch(a){console.error("Error fetching warehouse:",a)}}))(),ee(ce,a=>_(this,null,function*(){a&&(yield fetchItemData(a))}));const w=o([]),J=()=>{const a=p.value,t=y.value,e=Number(m.value),c=w.value.find(q=>q.itemCode===a&&q.warehouse===t);c?c.quantity+=e:w.value.push({itemCode:a,warehouse:t,quantity:e}),U()},W=()=>p.value.trim()!==""&&y.value.trim()!==""&&m.value!==null&&!isNaN(m.value)&&m.value>0,me=()=>{if(W()){if(d.value.itemCode){const a=w.value.find(t=>t.itemCode===d.value.itemCode&&t.warehouse===d.value.warehouse);a&&(a.quantity=m.value,a.warehouse=y.value,a.itemCode=p.value)}else J();U(),d.value={}}},ve=()=>{if(W()){if(d.value.itemCode){const a=w.value.find(t=>t.itemCode===d.value.itemCode&&t.warehouse===d.value.warehouse);a&&(a.quantity=m.value,a.warehouse=y.value,a.itemCode=p.value)}else J();U(),z(),d.value={}}},U=()=>{p.value="",m.value="",y.value=""},pe=o([]);pe.value=de.value,o("");let i=o("New");const D=o(""),A=o("Material Transfer"),Q=o(!1),B=o(""),he=()=>{Q.value=!0;const a=new Html5Qrcode("reader");a.start({facingMode:"environment"},t=>{console.log("QR code scanned:",t),alert("QR code scanned: "+t),K(B.value),H(a)},t=>{B.value=t,alert(" QR code: "+B.value),K(B.value),H(a)})},H=a=>{Q.value=!1,a.stop()},O=o(""),K=a=>_(this,null,function*(){try{const t=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${a}`);if(!t.ok)throw new Error("Network response was not ok");const e=yield t.json();return O.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(t){return console.error("Error fetching item details:",t),null}}),_e=ae(()=>{const a=new Set;return ue.value.filter(t=>{const e=a.has(t.name);return a.add(t.name),!e})});ae(()=>_e.value.some(a=>a.name===O.value)),Ce(()=>{O.value&&(p.value=O.value)}),console.log("linkName",N);const h=o([]),fe=()=>_(this,null,function*(){try{const a=yield R.get("/api/method/wms.api.my_api.get_material_by_name",{params:{name:N.value}});if(h.value=a.data.message,console.log("apiData",h.value),a.data&&a.data.message&&(A.value=h.value.material_request_type||"",D.value=h.value.schedule_date||"",h.value.items&&h.value.items.length>0)){const t=h.value.items[0];p.value=t.item_code||"",y.value=t.warehouse||"",m.value=t.qty||""}h.value?(i.value=h.value.name,h.value.items.forEach(t=>{w.value.push({itemCode:t.item_code,warehouse:t.warehouse,quantity:t.qty})})):console.error("Invalid response data:",a.data)}catch(a){console.log("Error while fetching data",a.response)}});ke(()=>{r.query.linkName&&fe()});const ge=()=>_(this,null,function*(){const a=n.get("sid"),t={schedule_date:D.value,material_request_type:A.value,items:w.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity})),docstatus:0};try{if(i.value&&i.value!=="New"){const e=yield R.put(`/api/resource/Material Request/${i.value}`,t,{headers:{Authorization:`Bearer ${a}`}});console.log("Updated Material Request",e.data),alert("Updated Material Request: "+e.data.data.name)}else{const e=yield R.post("/api/resource/Material Request",t,{headers:{Authorization:`Bearer ${a}`}});console.log("Created Material Request",e.data),i.value=e.data.data.name,alert("Created Material Request: "+i.value)}}catch(e){console.error("Error in Material Request process:",e);try{const c=JSON.parse(e.response.data._server_messages),q=JSON.parse(c[0]);alert(q.message)}catch(c){console.error("Error parsing server message:",c),alert("An unexpected error occurred.")}}}),ye=()=>_(this,null,function*(){const a=n.get("sid"),t={schedule_date:D.value,material_request_type:A.value,items:w.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity})),docstatus:1};try{if(i.value&&i.value!=="New"){const e=yield R.put(`/api/resource/Material Request/${i.value}`,t,{headers:{Authorization:`Bearer ${a}`}});console.log("Updated Material Request",e.data),alert("Updated Material Request: "+e.data.data.name)}else{const e=yield R.post("/api/resource/Material Request",t,{headers:{Authorization:`Bearer ${a}`}});console.log("Created Material Request",e.data),i.value=e.data.data.name,alert("Created Material Request: "+i.value)}}catch(e){console.error("Error in Material Request process:",e);try{const c=JSON.parse(e.response.data._server_messages),q=JSON.parse(c[0]);alert(q.message)}catch(c){console.error("Error parsing server message:",c),alert("An unexpected error occurred.")}}});return(a,t)=>(u(),te(Ee,{pageTitle:b(i),home:"shopping-bag",onCartIconClick:le,class:"text-xs"},{body:Re(()=>[s("div",Ae,[s("div",{onClick:l,id:"containerIII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[Qe,S(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>A.value=e)},Be,512),[[Se,A.value]])]),s("div",{onClick:l,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[Oe,S(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>D.value=e)},null,512),[[P,D.value]])]),s("div",Pe,[Te,C(b(k),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:z})]),s("div",$e,[s("div",je,[(u(!0),f($,null,T(w.value,(e,c)=>(u(),f("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:c,onClick:q=>I(e)},[s("div",ze,[C(b(k),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),s("div",Ve,[s("p",null,x(e.itemCode)+" | "+x(e.warehouse),1)]),s("div",Fe,x(e.quantity),1)]),C(b(k),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,Ue))),128))])]),S(s("div",Je,null,512),[[Ne,Q.value]]),g.value?(u(),f("div",We,[s("div",{onClick:l,id:"space"},[s("div",{onClick:l,id:"scrollerLine"})]),He,Ke,s("div",Ge,[S(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[P,p.value]]),s("datalist",Xe,[(u(!0),f($,null,T(j.value,e=>(u(),f("option",{key:e.name,value:e.name},x(e.name),9,Ye))),128))]),Me(),s("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:he},[C(b(k),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),Ze,ea,s("div",aa,[S(s("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e)},null,512),[[P,y.value]]),s("datalist",ta,[(u(!0),f($,null,T(V.value,e=>(u(),f("option",{key:e,value:e},x(e),9,sa))),128))]),s("span",{class:"barcode-scanner",onClick:E},[C(b(k),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),oa,ra,S(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>m.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[P,m.value]]),na,s("button",{id:"addNew",onClick:me},"Submit and Add New"),la,s("button",{id:"sub",onClick:ve},"Submit ")])):se("",!0),M.value?(u(),f("div",{key:1,class:"barcode-scanner-container",onClick:ne},ca)):se("",!0),s("div",ua,[s("div",da,[(u(!0),f($,null,T(a.submittedData,e=>(u(),f("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[s("div",ma,[(u(),te(Ie(e.icon),{class:"h-5 w-5 text-gray-500"})),C(b(k),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),s("div",va,[s("p",null,x(e.itemCode)+"| "+x(e.warehouse),1)]),s("div",pa,x(e.quantity),1)]),C(b(k),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),s("div",{id:"btnDiv",class:"w-full flex justify-around sm:w-96 py-2 standalone:pb-safe-bottom"},[s("button",{id:"submitPurchaseReceipt",onClick:ye},"Submit"),s("button",{id:"savePurchaseReceipt",onClick:ge},"Save")])])]),_:1},8,["pageTitle"]))}};export{Ca as default};
