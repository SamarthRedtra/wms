var qe=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var Z=(h,n,r)=>n in h?qe(h,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[n]=r,ee=(h,n)=>{for(var r in n||(n={}))Ce.call(n,r)&&Z(h,r,n[r]);if(Y)for(var r of Y(n))Re.call(n,r)&&Z(h,r,n[r]);return h};var p=(h,n,r)=>new Promise((S,g)=>{var N=i=>{try{I(r.next(i))}catch(j){g(j)}},m=i=>{try{I(r.throw(i))}catch(j){g(j)}},I=i=>i.done?S(i.value):Promise.resolve(i.value).then(N,m);I((r=r.apply(h,n)).next())});import{m as ke,r as o,H as ae,I as te,B as se,P as Me,q as Se,b as oe,w as Ne,u as x,o as l,d as s,s as R,Q as re,v as U,i as d,j as A,t as w,F as Q,g as k,x as M,z as Ie,e as je,f as ne,K as Ee}from"./index-03cc7949.js";import Le from"./BaseLayout-33181b3c.js";import{Q as B}from"./quagga.min-76816692.js";import{a as q}from"./axios-fc3df026.js";import{u as Pe}from"./index-192d3f78.js";import"./notifications-9b74206f.js";const De={class:"flex flex-col items-center"},Ae=s("p",null,"Purpose",-1),Qe=s("option",{value:"Material Transfer"},"Material Transfer",-1),Be=s("option",{value:"Purchase"},"Purchase",-1),Oe=s("option",{value:"Material Request"},"Material Request",-1),Te=[Qe,Be,Oe],Ue=s("p",null,"RequiredDate",-1),$e=s("p",null,"Project",-1),Ve=["value"],ze={id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},Fe=s("p",null,"Material Requests",-1),Je={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},We={class:"flex flex-col bg-white rounded"},He=["onClick"],Ke={class:"flex flex-row items-center gap-3 grow"},Ge={class:"text-xs font-normal text-gray-800 leading-6"},Xe={id:"circleii"},Ye={id:"reader"},Ze={key:0,class:"add-form"},ea=s("br",null,null,-1),aa=s("label",{for:"itemName"},"Item",-1),ta={class:"barcode-input"},sa={id:"searchName"},oa=["value"],ra=s("br",null,null,-1),na=s("label",{for:"itemName"},"Warehouse",-1),la={class:"barcode-input"},ia={id:"searchWarehouse"},ca=["value"],ua=s("br",null,null,-1),da=s("label",{for:"itemName"},"Quantity",-1),ma=s("br",null,null,-1),va=s("br",null,null,-1),pa=s("div",{id:"barcodeScanner"},null,-1),ha=[pa],_a={class:"flex flex-col gap-5 my-4 w-full"},fa={class:"flex flex-col bg-white rounded"},ga={class:"flex flex-row items-center gap-3 grow"},ya={class:"text-sm font-normal text-gray-800 leading-6"},wa={id:"circleii"},ja={__name:"NewMaterialRequest",setup(h){const{cookies:n}=Pe(),r=ke(),S=o("");S.value=r.query.linkName,o(!1);const g=o(!1);o("");const N=o(!1),m=o({}),I=a=>{m.value=ee({},a),_.value=a.itemCode,y.value=a.warehouse,v.value=a.quantity,g.value=!0},i=()=>p(this,null,function*(){g.value=!1,D.value=!1}),j=()=>p(this,null,function*(){g.value=!1,N.value=!0;try{yield le(),ie()}catch(a){console.error("Error loading Quagga:",a)}}),le=()=>new Promise((a,t)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=a,e.onerror=t,document.head.appendChild(e)}),ie=()=>{B.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(a){if(a){console.error(a);return}B.start()})},ce=()=>{N.value=!1,B&&B.stop&&B.stop()},F=()=>{g.value=!g.value,D.value=!1},ue=()=>{window.location.href="/StockCount"};ae({doctype:"Purchase Order",fields:["*"],auto:!0});const de=ae({doctype:"Warehouse",fields:["*"],auto:!0}),J=o([]);te(()=>de.data,a=>{if(a&&Array.isArray(a)){const t=a.filter(e=>e.is_group===0);J.value=t.map(e=>e.name)}});const _=o(""),y=o(""),v=o(0),E=o(""),me=o(""),ve=o([]),pe=o([]);o({});const $=o([]);(()=>p(this,null,function*(){try{const a=yield q.get("/api/method/wms.api.my_api.get_all_items");$.value=a.data.message,console.log("itemList data",$.value)}catch(a){console.error("Error fetching warehouse:",a)}}))();const W=o([]);(()=>p(this,null,function*(){try{const a=yield q.get("/api/method/wms.api.my_api.get_all_company");W.value=a.data.message,console.log("companyList data",W.value)}catch(a){console.error("Error fetching warehouse:",a)}}))(),te(me,a=>p(this,null,function*(){a&&(yield fetchItemData(a))}));const V=o([]);(()=>p(this,null,function*(){try{const a=yield q.get('/api/resource/Project?fields=["name","project_name"]');console.log(a.data.data.map(t=>t.name),"project list"),V.value=a.data.data,console.log("projectList data",V.value)}catch(a){console.error("Error fetching warehouse:",a)}}))();const b=o([]),H=()=>{const a=_.value,t=y.value,e=Number(v.value),u=b.value.find(C=>C.itemCode===a&&C.warehouse===t);u?u.quantity+=e:b.value.push({itemCode:a,warehouse:t,quantity:e}),z()},K=()=>_.value.trim()!==""&&y.value.trim()!==""&&v.value!==null&&!isNaN(v.value)&&v.value>0,he=()=>{if(K()){if(m.value.itemCode){const a=b.value.find(t=>t.itemCode===m.value.itemCode&&t.warehouse===m.value.warehouse);a&&(a.quantity=v.value,a.warehouse=y.value,a.itemCode=_.value)}else H();z(),m.value={}}},_e=()=>{if(K()){if(m.value.itemCode){const a=b.value.find(t=>t.itemCode===m.value.itemCode&&t.warehouse===m.value.warehouse);a&&(a.quantity=v.value,a.warehouse=y.value,a.itemCode=_.value)}else H();z(),F(),m.value={}}},z=()=>{_.value="",v.value="",y.value=""},fe=o([]);fe.value=pe.value,o("");let c=o("New");const L=o(""),P=o("Material Transfer"),D=o(!1),O=o(""),ge=()=>{D.value=!0;const a=new Html5Qrcode("reader");a.start({facingMode:"environment"},t=>{console.log("QR code scanned:",t),alert("QR code scanned: "+t),X(O.value),G(a)},t=>{O.value=t,alert(" QR code: "+O.value),X(O.value),G(a)})},G=a=>{D.value=!1,a.stop()},T=o(""),X=a=>p(this,null,function*(){try{const t=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${a}`);if(!t.ok)throw new Error("Network response was not ok");const e=yield t.json();return T.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(t){return console.error("Error fetching item details:",t),null}}),ye=se(()=>{const a=new Set;return ve.value.filter(t=>{const e=a.has(t.name);return a.add(t.name),!e})});se(()=>ye.value.some(a=>a.name===T.value)),Me(()=>{T.value&&(_.value=T.value)}),console.log("linkName",S);const f=o([]),we=()=>p(this,null,function*(){try{const a=yield q.get("/api/method/wms.api.my_api.get_material_by_name",{params:{name:S.value}});if(f.value=a.data.message,console.log("apiData",f.value),a.data&&a.data.message&&(P.value=f.value.material_request_type||"",L.value=f.value.schedule_date||"",f.value.items&&f.value.items.length>0)){const t=f.value.items[0];_.value=t.item_code||"",y.value=t.warehouse||"",v.value=t.qty||"",E.value=(t==null?void 0:t.project)||""}f.value?(c.value=f.value.name,f.value.items.forEach(t=>{b.value.push({itemCode:t.item_code,warehouse:t.warehouse,quantity:t.qty})})):console.error("Invalid response data:",a.data)}catch(a){console.log("Error while fetching data",a.response)}});Se(()=>{r.query.linkName&&we()});const be=()=>p(this,null,function*(){const a=n.get("sid"),t={schedule_date:L.value,material_request_type:P.value,items:b.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity,project:E.value})),docstatus:0};try{if(c.value&&c.value!=="New"){const e=yield q.put(`/api/resource/Material Request/${c.value}`,t,{headers:{Authorization:`Bearer ${a}`}});console.log("Updated Material Request",e.data),alert("Updated Material Request: "+e.data.data.name)}else{const e=yield q.post("/api/resource/Material Request",t,{headers:{Authorization:`Bearer ${a}`}});console.log("Created Material Request",e.data),c.value=e.data.data.name,alert("Created Material Request: "+c.value)}}catch(e){console.error("Error in Material Request process:",e);try{const u=JSON.parse(e.response.data._server_messages),C=JSON.parse(u[0]);alert(C.message)}catch(u){console.error("Error parsing server message:",u),alert("An unexpected error occurred.")}}}),xe=()=>p(this,null,function*(){const a=n.get("sid"),t={schedule_date:L.value,material_request_type:P.value,items:b.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:e.quantity,project:E.value})),docstatus:1};try{if(c.value&&c.value!=="New"){const e=yield q.put(`/api/resource/Material Request/${c.value}`,t,{headers:{Authorization:`Bearer ${a}`}});console.log("Updated Material Request",e.data),alert("Updated Material Request: "+e.data.data.name)}else{const e=yield q.post("/api/resource/Material Request",t,{headers:{Authorization:`Bearer ${a}`}});console.log("Created Material Request",e.data),c.value=e.data.data.name,alert("Created Material Request: "+c.value)}}catch(e){console.error("Error in Material Request process:",e);try{const u=JSON.parse(e.response.data._server_messages),C=JSON.parse(u[0]);alert(C.message)}catch(u){console.error("Error parsing server message:",u),alert("An unexpected error occurred.")}}});return(a,t)=>(l(),oe(Le,{pageTitle:x(c),home:"shopping-bag",onCartIconClick:ue,class:"text-xs"},{body:Ne(()=>[s("div",De,[s("div",{onClick:i,id:"containerIII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[Ae,R(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>P.value=e)},Te,512),[[re,P.value]])]),s("div",{onClick:i,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[Ue,R(s("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=e=>L.value=e)},null,512),[[U,L.value]])]),s("div",{onClick:i,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[$e,R(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>E.value=e)},[(l(!0),d(Q,null,A(V.value,e=>(l(),d("option",{key:e.name,value:e.name},w(e.project_name+" ("+e.name+")"),9,Ve))),128))],512),[[re,E.value]])]),s("div",ze,[Fe,k(x(M),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:F})]),s("div",Je,[s("div",We,[(l(!0),d(Q,null,A(b.value,(e,u)=>(l(),d("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:u,onClick:C=>I(e)},[s("div",Ke,[k(x(M),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),s("div",Ge,[s("p",null,w(e.itemCode)+" | "+w(e.warehouse),1)]),s("div",Xe,w(e.quantity),1)]),k(x(M),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,He))),128))])]),R(s("div",Ye,null,512),[[Ie,D.value]]),g.value?(l(),d("div",Ze,[s("div",{onClick:i,id:"space"},[s("div",{onClick:i,id:"scrollerLine"})]),ea,aa,s("div",ta,[R(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>_.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[U,_.value]]),s("datalist",sa,[(l(!0),d(Q,null,A($.value,e=>(l(),d("option",{key:e.name,value:e.name},w(e.name),9,oa))),128))]),je(),s("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:ge},[k(x(M),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ra,na,s("div",la,[R(s("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e)},null,512),[[U,y.value]]),s("datalist",ia,[(l(!0),d(Q,null,A(J.value,e=>(l(),d("option",{key:e,value:e},w(e),9,ca))),128))]),s("span",{class:"barcode-scanner",onClick:j},[k(x(M),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ua,da,R(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>v.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[U,v.value]]),ma,s("button",{id:"addNew",onClick:he},"Submit and Add New"),va,s("button",{id:"sub",onClick:_e},"Submit ")])):ne("",!0),N.value?(l(),d("div",{key:1,class:"barcode-scanner-container",onClick:ce},ha)):ne("",!0),s("div",_a,[s("div",fa,[(l(!0),d(Q,null,A(a.submittedData,e=>(l(),d("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[s("div",ga,[(l(),oe(Ee(e.icon),{class:"h-5 w-5 text-gray-500"})),k(x(M),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),s("div",ya,[s("p",null,w(e.itemCode)+"| "+w(e.warehouse),1)]),s("div",wa,w(e.quantity),1)]),k(x(M),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),s("div",{id:"btnDiv",class:"w-full flex justify-around sm:w-96 py-2 standalone:pb-safe-bottom"},[s("button",{id:"submitPurchaseReceipt",onClick:xe},"Submit"),s("button",{id:"savePurchaseReceipt",onClick:be},"Save")])])]),_:1},8,["pageTitle"]))}};export{ja as default};
