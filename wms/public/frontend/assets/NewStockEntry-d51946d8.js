var Se=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var Z=(h,l,r)=>l in h?Se(h,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[l]=r,ee=(h,l)=>{for(var r in l||(l={}))Ce.call(l,r)&&Z(h,r,l[r]);if(Y)for(var r of Y(l))Ee.call(l,r)&&Z(h,r,l[r]);return h};var f=(h,l,r)=>new Promise((q,w)=>{var D=i=>{try{L(r.next(i))}catch(R){w(R)}},u=i=>{try{L(r.throw(i))}catch(R){w(R)}},L=i=>i.done?q(i.value):Promise.resolve(i.value).then(D,u);L((r=r.apply(h,l)).next())});import{m as Ne,r as o,H as te,I as ae,B as se,P as Ie,q as qe,b as oe,w as Re,u as x,o as n,d as a,s as N,Q as re,i as c,j as A,t as p,F as Q,g as S,x as C,z as Ae,v as j,e as Qe,f as ne,K as De}from"./index-c4230fc7.js";import Le from"./BaseLayout-e39ea2b2.js";import{Q as T}from"./quagga.min-da1f328f.js";import{a as I}from"./axios-fc3df026.js";import{u as Me}from"./index-1210b84f.js";import"./notifications-765e05d1.js";const Be={class:"flex flex-col items-center"},Oe=a("p",null,"Stock Entry Type",-1),Te=a("option",{value:""},null,-1),Ue=a("option",{value:"Material Receipt"},"Material Receipt",-1),$e=a("option",{value:"Material Transfer"},"Material Transfer",-1),je=[Te,Ue,$e],ze=a("p",null,"Company",-1),Pe=["value"],Ve={id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},We=a("p",null,"Stock Entries",-1),Fe={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},He={class:"flex flex-col bg-white rounded"},Je=["onClick"],Ke={class:"flex flex-row items-center gap-3 grow"},Ge={class:"text-xs font-normal text-gray-800 leading-6"},Xe={id:"circleii"},Ye={id:"reader"},Ze={key:0,class:"add-form"},et=a("br",null,null,-1),tt=a("label",{for:"itemName"},"Item",-1),at={class:"barcode-input"},st={id:"searchName"},ot=["value"],rt=a("br",null,null,-1),nt=a("label",{for:"itemName"},"Source Warehouse",-1),lt={class:"barcode-input"},ct={id:"searchWarehouse"},ut=["value"],it=a("br",null,null,-1),dt=a("label",{for:"itemName"},"Target Warehouse",-1),mt={class:"barcode-input"},vt={id:"searchWarehouse"},pt=["value"],ht=a("br",null,null,-1),_t=a("label",{for:"itemName"},"Quantity",-1),yt=a("br",null,null,-1),ft=a("br",null,null,-1),wt=a("div",{id:"barcodeScanner"},null,-1),gt=[wt],bt={class:"flex flex-col gap-5 my-4 w-full"},xt={class:"flex flex-col bg-white rounded"},kt={class:"flex flex-row items-center gap-3 grow"},St={class:"text-sm font-normal text-gray-800 leading-6"},Ct={id:"circleii"},Mt={__name:"NewStockEntry",setup(h){const{cookies:l}=Me(),r=Ne(),q=o("");q.value=r.query.stName,console.log("stName",q.value),o(!1);const w=o(!1);o("");const D=o(!1),u=o({}),L=t=>{u.value=ee({},t),_.value=t.itemCode,g.value=t.warehouse,b.value=t.twarehouse,v.value=t.quantity,w.value=!0},i=()=>f(this,null,function*(){w.value=!1,O.value=!1}),R=()=>f(this,null,function*(){w.value=!1,D.value=!0;try{yield le(),ce()}catch(t){console.error("Error loading Quagga:",t)}}),le=()=>new Promise((t,s)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=t,e.onerror=s,document.head.appendChild(e)}),ce=()=>{T.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(t){if(t){console.error(t);return}T.start()})},ue=()=>{D.value=!1,T&&T.stop&&T.stop()},H=()=>{w.value=!w.value,O.value=!1},ie=()=>{window.location.href="/StockCount"};te({doctype:"Purchase Order",fields:["*"],auto:!0});const de=te({doctype:"Warehouse",fields:["*"],auto:!0}),z=o([]);ae(()=>de.data,t=>{if(t&&Array.isArray(t)){const s=t.filter(e=>e.is_group===0);z.value=s.map(e=>e.name)}});const _=o(""),g=o(""),b=o(""),v=o(0),me=o(""),ve=o(""),pe=o([]),he=o([]);o({});const P=o([]);(()=>f(this,null,function*(){try{const t=yield I.get("/api/method/wms.api.my_api.get_all_items");P.value=t.data.message,console.log("itemList data",P.value)}catch(t){console.error("Error fetching warehouse:",t)}}))();const V=o([]);(()=>f(this,null,function*(){try{const t=yield I.get("/api/method/wms.api.my_api.get_all_company");V.value=t.data.message,console.log("companyList data",V.value)}catch(t){console.error("Error fetching warehouse:",t)}}))(),ae(me,t=>f(this,null,function*(){t&&(yield fetchItemData(t))}));const k=o([]),J=()=>{const t=_.value,s=g.value,e=b.value,m=Number(v.value),E=k.value.find(F=>F.itemCode===t&&F.warehouse===s&&F.twarehouse===e);E?E.quantity+=m:k.value.push({itemCode:t,warehouse:s,twarehouse:e,quantity:m}),W()},K=()=>_.value.trim()!==""&&g.value.trim()!==""&&b.value.trim()!==""&&v.value!==null&&!isNaN(v.value)&&v.value>0,_e=()=>{if(K()){if(u.value.itemCode){const t=k.value.find(s=>s.itemCode===u.value.itemCode&&s.warehouse===u.value.warehouse&&s.twarehouse===u.value.twarehouse);t&&(t.quantity=v.value,t.warehouse=g.value,t.twarehouse=b.value,t.itemCode=_.value)}else J();W(),u.value={}}},ye=()=>{if(K()){if(u.value.itemCode){const t=k.value.find(s=>s.itemCode===u.value.itemCode&&s.warehouse===u.value.warehouse&&s.twarehouse===u.value.twarehouse);t&&(t.quantity=v.value,t.warehouse=g.value,t.twarehouse=b.value,t.itemCode=_.value)}else J();W(),H(),u.value={}}},W=()=>{_.value="",v.value="",g.value="",b.value="",ve.value=""},fe=o([]);fe.value=he.value,o("");let d=o("New");const M=o(""),B=o(""),O=o(!1),U=o(""),we=()=>{O.value=!0;const t=new Html5Qrcode("reader");t.start({facingMode:"environment"},s=>{console.log("QR code scanned:",s),alert("QR code scanned: "+s),X(U.value),G(t)},s=>{U.value=s,alert(" QR code: "+U.value),X(U.value),G(t)})},G=t=>{O.value=!1,t.stop()},$=o(""),X=t=>f(this,null,function*(){try{const s=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${t}`);if(!s.ok)throw new Error("Network response was not ok");const e=yield s.json();return $.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(s){return console.error("Error fetching item details:",s),null}}),ge=se(()=>{const t=new Set;return pe.value.filter(s=>{const e=t.has(s.name);return t.add(s.name),!e})});se(()=>ge.value.some(t=>t.name===$.value)),Ie(()=>{$.value&&(_.value=$.value)}),console.log("stName",q);const y=o([]),be=()=>f(this,null,function*(){try{const t=yield I.get("/api/method/wms.api.my_api.get_stockentry_by_name",{params:{name:q.value}});if(y.value=t.data.message,console.log("apiData",y.value),t.data&&t.data.message&&(B.value=y.value.stock_entry_type||"",M.value=y.value.company||"",y.value.items&&y.value.items.length>0)){const s=y.value.items[0];_.value=s.item_code||"",g.value=s.s_warehouse||"",b.value=s.t_warehouse||"",v.value=s.qty||""}y.value?(d.value=y.value.name,y.value.items.forEach(s=>{k.value.push({itemCode:s.item_code,warehouse:s.s_warehouse,twarehouse:s.t_warehouse,quantity:s.qty})})):console.error("Invalid response data:",t.data)}catch(t){console.log("Error while fetching data",t.response)}});qe(()=>{r.query.stName&&be()});const xe=()=>f(this,null,function*(){const t=l.get("sid"),s={company:M.value,stock_entry_type:B.value,items:k.value.map(e=>({item_code:e.itemCode,s_warehouse:e.warehouse,t_warehouse:e.twarehouse,qty:e.quantity})),docstatus:0};try{if(d.value&&d.value!=="New"){const e=yield I.put(`/api/resource/Stock Entry/${d.value}`,s,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Entry",e.data),alert("Updated Stock Entry: "+e.data.data.name)}else{const e=yield I.post("/api/resource/Stock Entry",s,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Entry",e.data),d.value=e.data.data.name,alert("Created Stock Entry: "+d.value)}}catch(e){console.error("Error in Stock Entry process:",e);try{const m=JSON.parse(e.response.data._server_messages),E=JSON.parse(m[0]);alert(E.message)}catch(m){console.error("Error parsing server message:",m),alert("An unexpected error occurred.")}}}),ke=()=>f(this,null,function*(){const t=l.get("sid"),s={company:M.value,stock_entry_type:B.value,items:k.value.map(e=>({item_code:e.itemCode,s_warehouse:e.warehouse,t_warehouse:e.twarehouse,qty:e.quantity})),docstatus:1};try{if(d.value&&d.value!=="New"){const e=yield I.put(`/api/resource/Stock Entry/${d.value}`,s,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Entry",e.data),alert("Updated Stock Entry: "+e.data.data.name)}else{const e=yield I.post("/api/resource/Stock Entry",s,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Entry",e.data),d.value=e.data.data.name,alert("Created Stock Entry: "+d.value)}}catch(e){console.error("Error in Stock Entry process:",e);try{const m=JSON.parse(e.response.data._server_messages),E=JSON.parse(m[0]);alert(E.message)}catch(m){console.error("Error parsing server message:",m),alert("An unexpected error occurred.")}}});return(t,s)=>(n(),oe(Le,{pageTitle:x(d),home:"layers",onCartIconClick:ie,class:"text-xs"},{body:Re(()=>[a("div",Be,[a("div",{onClick:i,id:"containerIII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[Oe,N(a("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>B.value=e)},je,512),[[re,B.value]])]),a("div",{onClick:i,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[ze,N(a("select",{"onUpdate:modelValue":s[1]||(s[1]=e=>M.value=e)},[(n(!0),c(Q,null,A(V.value,e=>(n(),c("option",{key:e.name,value:e.name},p(e.name),9,Pe))),128))],512),[[re,M.value]])]),a("div",Ve,[We,S(x(C),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:H})]),a("div",Fe,[a("div",He,[(n(!0),c(Q,null,A(k.value,(e,m)=>(n(),c("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:m,onClick:E=>L(e)},[a("div",Ke,[S(x(C),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),a("div",Ge,[a("p",null,p(e.itemCode)+" | "+p(e.warehouse),1),a("p",null,p(e.twarehouse),1)]),a("div",Xe,p(e.quantity),1)]),S(x(C),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,Je))),128))])]),N(a("div",Ye,null,512),[[Ae,O.value]]),w.value?(n(),c("div",Ze,[a("div",{onClick:i,id:"space"},[a("div",{onClick:i,id:"scrollerLine"})]),et,tt,a("div",at,[N(a("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>_.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[j,_.value]]),a("datalist",st,[(n(!0),c(Q,null,A(P.value,e=>(n(),c("option",{key:e.name,value:e.name},p(e.name),9,ot))),128))]),Qe(),a("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:we},[S(x(C),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),rt,nt,a("div",lt,[N(a("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":s[3]||(s[3]=e=>g.value=e)},null,512),[[j,g.value]]),a("datalist",ct,[(n(!0),c(Q,null,A(z.value,e=>(n(),c("option",{key:e,value:e},p(e),9,ut))),128))]),a("span",{class:"barcode-scanner",onClick:R},[S(x(C),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),it,dt,a("div",mt,[N(a("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":s[4]||(s[4]=e=>b.value=e)},null,512),[[j,b.value]]),a("datalist",vt,[(n(!0),c(Q,null,A(z.value,e=>(n(),c("option",{key:e,value:e},p(e),9,pt))),128))]),a("span",{class:"barcode-scanner",onClick:R},[S(x(C),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ht,_t,N(a("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>v.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[j,v.value]]),yt,a("button",{id:"addNew",onClick:_e},"Submit and Add New"),ft,a("button",{id:"sub",onClick:ye},"Submit ")])):ne("",!0),D.value?(n(),c("div",{key:1,class:"barcode-scanner-container",onClick:ue},gt)):ne("",!0),a("div",bt,[a("div",xt,[(n(!0),c(Q,null,A(t.submittedData,e=>(n(),c("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[a("div",kt,[(n(),oe(De(e.icon),{class:"h-5 w-5 text-gray-500"})),S(x(C),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),a("div",St,[a("p",null,p(e.itemCode)+"| "+p(e.warehouse),1)]),a("div",Ct,p(e.quantity),1)]),S(x(C),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),a("div",{id:"btnDiv",class:"w-full flex justify-around sm:w-96 py-2 standalone:pb-safe-bottom"},[a("button",{id:"submitPurchaseReceipt",onClick:ke},"Submit"),a("button",{id:"savePurchaseReceipt",onClick:xe},"Save")])])]),_:1},8,["pageTitle"]))}};export{Mt as default};
