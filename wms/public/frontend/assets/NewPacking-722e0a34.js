var Me=Object.defineProperty;var re=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var ie=(h,r,n)=>r in h?Me(h,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[r]=n,ce=(h,r)=>{for(var n in r||(r={}))$e.call(r,n)&&ie(h,n,r[n]);if(re)for(var n of re(r))Oe.call(r,n)&&ie(h,n,r[n]);return h};var i=(h,r,n)=>new Promise((q,P)=>{var x=l=>{try{b(n.next(l))}catch(E){P(E)}},M=l=>{try{b(n.throw(l))}catch(E){P(E)}},b=l=>l.done?q(l.value):Promise.resolve(l.value).then(x,M);b((n=n.apply(h,r)).next())});import{a as s,u as Be,a7 as Qe,a9 as ue,w as F,c as W,ac as Ue,b as Ve,x as Fe,l as A,n as v,f as p,v as o,a3 as R,a4 as j,ab as je,j as y,F as G,E as X,I as z,$ as J,k as C,q as D,a6 as ze,t as Y,U as de}from"./frappe-ui-63c927c1.js";import Je from"./BaseLayout-fcc95c5f.js";import{Q as Z}from"./quagga.min-a38e8bb9.js";import{a as _}from"./axios-fc3df026.js";import{u as He}from"./index-fbc0966c.js";import"./index-1774bd7d.js";import"./notifications-4b74d839.js";const Ke={class:"flex flex-col items-center"},We=o("p",null,"Select Delivery Note",-1),Ge={id:"scanInput",class:"relative"},Xe={key:0,class:"item-dropdown"},Ye=["onClick"],Ze=o("br",null,null,-1),ea=o("p",null,"From Package No.",-1),aa=o("p",null,"Packing Slips",-1),ta={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},sa={class:"flex flex-col bg-white rounded"},oa=["onClick"],na={class:"flex flex-row items-center gap-3 grow"},la={class:"text-xs font-normal text-gray-800 leading-6"},ra={id:"circleii"},ia={id:"reader"},ca={key:0,class:"add-form"},ua=o("br",null,null,-1),da=o("label",{for:"itemName"},"Item",-1),ma={class:"barcode-input"},va={id:"searchName"},pa=["value"],ha=o("br",null,null,-1),fa=o("label",{for:"itemName"},"Quantity",-1),ya=o("br",null,null,-1),_a=o("br",null,null,-1),ga=o("div",{id:"barcodeScanner"},null,-1),wa=[ga],ka={id:"btnDiv",class:"w-full flex justify-around bg-none sm:w-96 py-2 standalone:pb-safe-bottom"},me=4,Aa={__name:"NewPacking",setup(h){const{cookies:r}=He(),n=s("");s(1);const q=Be(),P=s("");P.value=q.query.linkName,Qe(),s(!1);const x=s(!1);s("");const M=s(!1),b=s(""),l=s({}),E=e=>{l.value=ce({},e),m.value=e.itemCode,b.value=e.deliveryDate,u.value=e.quantity,x.value=!0},$=()=>i(this,null,function*(){x.value=!1,L.value=!1}),ve=()=>{M.value=!1,Z&&Z.stop&&Z.stop()},ee=()=>{x.value=!x.value,L.value=!1},pe=()=>{window.location.href="/SalesOrderList"};ue({doctype:"Purchase Order",fields:["*"],auto:!0});const he=ue({doctype:"Warehouse",fields:["*"],auto:!0}),fe=s([]);F(()=>he.data,e=>{if(e&&Array.isArray(e)){const t=e.filter(a=>a.is_group===0);fe.value=t.map(a=>a.name)}});const m=s(""),u=s(0),ye=s(""),_e=s([]),ge=s([]);s({});const H=s([]),we=s([]);(()=>i(this,null,function*(){try{const e=yield _.get("/api/method/wms.api.my_api.get_all_items",{});H.value=e.data.message}catch(e){console.error("Error fetching warehouse:",e)}}))(),(()=>i(this,null,function*(){try{const e=yield _.get("/api/method/wms.api.my_api.get_all_warehouse",{});we.value=e.data.message}catch(e){console.error("Error fetching warehouse:",e)}}))();const ae=s([]);(()=>i(this,null,function*(){try{const e=yield _.get("/api/method/wms.api.my_api.get_internal_customers");ae.value=e.data.message;const t=ae.value.find(a=>a.represents_company===getCompany.value)}catch(e){console.error("Error fetching warehouse:",e)}}))(),F(ye,e=>i(this,null,function*(){e&&(yield fetchItemData(e))}));const g=s([]),te=()=>{const e=m.value,t=H.value.find(I=>I.name===e),a=t?t.item_name:"Unknown Item",c=b.value,f=Number(u.value),N=g.value.find(I=>I.itemCode===e&&I.itemName===a&&I.deliveryDate===c);N?N.quantity+=f:g.value.push({itemCode:e,quantity:f,itemName:a,deliveryDate:c}),K()},se=()=>m.value.trim()!==""&&u.value!==null&&!isNaN(u.value)&&u.value>0,ke=()=>{if(se()){if(l.value.itemCode){const e=g.value.find(t=>t.itemCode===l.value.itemCode&&t.deliveryDate===l.value.deliveryDate);e&&(e.quantity=u.value,e.itemCode=m.value)}else te();K(),l.value={}}},be=()=>{if(se()){if(l.value.itemCode){const e=g.value.find(t=>t.itemCode===l.value.itemCode&&t.deliveryDate===l.value.deliveryDate);e&&(e.quantity=u.value,e.itemCode=m.value)}else te();K(),ee(),l.value={}}},K=()=>{m.value="",u.value=""},Ce=s([]);Ce.value=ge.value,s("");let d=s("New");const O=s(1),L=s(!1),B=s(""),S=s(!1),Q=s([]),U=s(1);s(!1);const T=s([]);s(!1);const xe=()=>i(this,null,function*(){try{const e=yield _.get("/api/method/wms.api.my_api.get_draft_delivery_notes");Q.value=e.data.message,T.value=Q.value}catch(e){console.error("Error fetching customers:",e)}}),Ie=W(()=>T.value.slice(0,U.value*me)),Se=()=>{U.value++},oe=((e,t)=>{let a;return function(...c){const f=this;clearTimeout(a),a=setTimeout(()=>e.apply(f,c),t)}})(()=>i(this,null,function*(){n.value.trim()===""?T.value=Q.value:T.value=Q.value.filter(e=>e.name.toLowerCase().includes(n.value.toLowerCase())),U.value=1}),300),Ne=()=>{S.value=!S.value,S.value&&xe()},De=()=>{S.value=!1},qe=e=>{n.value=e.name,S.value=!1},Pe=()=>{L.value=!0;const e=new Html5Qrcode("reader");e.start({facingMode:"environment"},t=>{alert("QR code scanned: "+t),le(B.value),ne(e)},t=>{B.value=t,alert(" QR code: "+B.value),le(B.value),ne(e)})},ne=e=>{L.value=!1,e.stop()},V=s(""),le=e=>i(this,null,function*(){try{const t=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${e}`);if(!t.ok)throw new Error("Network response was not ok");const a=yield t.json();return V.value=a.message.parent,a}catch(t){return console.error("Error fetching item details:",t),null}}),Ee=W(()=>{const e=new Set;return _e.value.filter(t=>{const a=e.has(t.name);return e.add(t.name),!a})});W(()=>Ee.value.some(e=>e.name===V.value)),Ue(()=>{V.value&&(m.value=V.value)}),console.log("selectedDeliveryNote",n.value);const w=s([]),Le=()=>i(this,null,function*(){try{const e=yield _.get("/api/method/wms.api.my_api.get_packing_by_name",{params:{name:P.value}});if(w.value=e.data.message,e.data&&e.data.message&&(n.value=w.value.delivery_note||"",w.value.items&&w.value.items.length>0)){const t=w.value.items[0];m.value=t.item_code||"",u.value=t.qty||"",b.value=t.delivery_date||""}!k.value&&w.value?(d.value=w.value.name,w.value.items.forEach(t=>{g.value.push({itemCode:t.item_code,quantity:t.qty}),console.log("apiData...value",w.value)})):console.error("Invalid response data:",e.data)}catch(e){console.log("Error while fetching data",e.response)}}),k=s([]),Te=e=>i(this,null,function*(){try{const t=yield _.get("/api/method/wms.api.my_api.get_deliverynote_by_name",{params:{name:e}});if(k.value=t.data.message,console.log(" deliveryData.value",k.value),t.data&&t.data.message&&(n.value=k.value.delivery_note||"",k.value.items&&k.value.items.length>0)){const a=k.value.items[0];m.value=a.item_code||"",u.value=a.qty||"",b.value=a.delivery_date||""}k.value?k.value.items.forEach(a=>{g.value.push({itemCode:a.item_code,deliveryDate:a.delivery_date,quantity:a.qty})}):console.error("Invalid response data:",t.data)}catch(t){console.log("Error while fetching data",t.response)}});F(n,e=>i(this,null,function*(){e&&(yield Te(e))})),Ve(()=>{q.query.linkName&&Le()});const Ae=()=>i(this,null,function*(){const e=r.get("sid"),t={delivery_note:"MAT-DN-2024-00001",from_case_no:O.value,items:g.value.map(a=>({item_code:a.itemCode,qty:a.quantity})),docstatus:0};console.log("requestData",t);try{if(d.value&&d.value!=="New"){const a=yield _.put(`/api/resource/Packing Slip/${d.value}`,t,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});alert("Updated Packing Slip: "+a.data.data.name)}else{const a=yield _.post("/api/resource/Packing Slip",t,{headers:{Authorization:`Bearer ${e}`}});d.value=a.data.data.name,alert("Created Packing Slip: "+d.value)}}catch(a){console.error("Error in Packing Slip process:",a);try{const c=JSON.parse(a.response.data._server_messages),f=JSON.parse(c[0]);alert(f.message)}catch(c){console.error("Error parsing server message:",c),alert("An unexpected error occurred.")}}}),Re=()=>i(this,null,function*(){const e=r.get("sid"),t={delivery_note:"MAT-DN-2024-00001",from_case_no:O.value,items:g.value.map(a=>({item_code:a.itemCode,qty:1})),docstatus:1};try{if(d.value&&d.value!=="New"){const a=yield _.put(`/api/resource/Packing Slip/${d.value}`,t,{headers:{Authorization:`Bearer ${e}`}});alert("Updated Packing Slip: "+a.data.data.name)}else{const a=yield _.post("/api/resource/Packing Slip",t,{headers:{Authorization:`Bearer ${e}`}});d.value=a.data.data.name,alert("Created Packing Slip: "+d.value)}}catch(a){console.error("Error in Packing Slip process:",a);const c=JSON.parse(a.response.data._server_messages),f=JSON.parse(c[0]),N=document.createElement("div");N.innerHTML=f.message;const I=N.textContent||N.innerText||"";alert(I)}});return s(""),F(q,(e,t)=>{t.name==="SalesOrderList"&&window.location.reload()}),(e,t)=>(p(),Fe(Je,{pageTitle:v(d),home:"codesandbox",onCartIconClick:pe,class:"text-xs"},{body:A(()=>[o("div",Ke,[o("div",{onClick:$,id:"containerIII",class:"text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[We,o("div",Ge,[R(o("input",{onInput:t[0]||(t[0]=(...a)=>v(oe)&&v(oe)(...a)),onKeyup:t[1]||(t[1]=je((...a)=>e.handleEnterPress&&e.handleEnterPress(...a),["enter"])),"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),id:"scanReceiptInput",placeholder:"Type Item and press enter",onClick:Ne},null,544),[[j,n.value]]),S.value?(p(),y("div",Xe,[(p(!0),y(G,null,X(Ie.value,(a,c)=>(p(),y("div",{key:a.name,class:"item",onClick:f=>qe(a)},[o("p",null,z(a.name),1)],8,Ye))),128)),T.value.length>U.value*me?(p(),y("div",{key:0,onClick:Se,class:"load-more"}," View More ")):J("",!0)])):J("",!0)])]),Ze,o("div",{onClick:$,id:"containerII",class:"text-base leading-6 rounded w-full py-1 px-4 border-none"},[ea,R(o("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>O.value=a)},null,512),[[j,O.value]])]),o("div",{onClick:De,id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},[aa,C(v(D),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:ee})]),o("div",ta,[o("div",sa,[(p(!0),y(G,null,X(g.value,(a,c)=>(p(),y("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:c,onClick:f=>E(a)},[o("div",na,[C(v(D),{name:"codesandbox",class:"h-5 w-5 text-gray-500"}),o("div",la,[o("p",null,z(a.itemCode),1)]),o("div",ra,z(a.quantity),1)]),C(v(D),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,oa))),128))])]),R(o("div",ia,null,512),[[ze,L.value]]),x.value?(p(),y("div",ca,[o("div",{onClick:$,id:"space"},[o("div",{onClick:$,id:"scrollerLine"})]),ua,da,o("div",ma,[R(o("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>m.value=a),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[j,m.value]]),o("datalist",va,[(p(!0),y(G,null,X(H.value,a=>(p(),y("option",{key:a.name,value:a.name},z(a.name),9,pa))),128))]),Y(),o("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:Pe},[C(v(D),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ha,fa,R(o("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>u.value=a),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[j,u.value]]),ya,o("button",{id:"addNew",onClick:ke},"Submit and Add New"),_a,o("button",{id:"sub",onClick:be},"Submit ")])):J("",!0),M.value?(p(),y("div",{key:1,class:"barcode-scanner-container",onClick:ve},wa)):J("",!0),o("div",ka,[C(v(de),{onClick:Re,variant:"outline",theme:"blue",id:"submitPurchaseReceipt",class:"shadow py-4 mt-5"},{prefix:A(()=>[C(v(D),{name:"truck",class:"w-4"})]),default:A(()=>[Y(" submit ")]),_:1}),C(v(de),{onClick:Ae,variant:"outline",theme:"blue",id:"savePurchaseReceipt",class:"shadow py-4 mt-5"},{prefix:A(()=>[C(v(D),{name:"truck",class:"w-4"})]),default:A(()=>[Y(" save ")]),_:1})])])]),_:1},8,["pageTitle"]))}};export{Aa as default};
