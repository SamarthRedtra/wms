var U=Object.defineProperty;var $=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var q=(t,n,a)=>n in t?U(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,I=(t,n)=>{for(var a in n||(n={}))L.call(n,a)&&q(t,a,n[a]);if($)for(var a of $(n))z.call(n,a)&&q(t,a,n[a]);return t};var R=(t,n,a)=>new Promise((o,r)=>{var v=c=>{try{y(a.next(c))}catch(m){r(m)}},w=c=>{try{y(a.throw(c))}catch(m){r(m)}},y=c=>c.done?o(c.value):Promise.resolve(c.value).then(v,w);y((a=a.apply(t,n)).next())});import{a as j,M as G,c as N,w as E,e as H,f as d,j as f,v as s,I as p,n as x,x as g,$ as k,F as O,E as D,k as h,q as B,l as b,t as M}from"./frappe-ui-cec019df.js";import J from"./FormField-d154d136.js";import{_ as K}from"./index-0e5fa8f2.js";import P from"./CustomIonModal-3b018d4e.js";import{f as C}from"./formatters-e2b36d58.js";const Q={class:"flex flex-row justify-between items-center pt-4"},W=s("h2",{class:"text-base font-semibold text-gray-800"},"Taxes & Charges",-1),X={class:"flex flex-row gap-3 items-center"},Y={class:"text-base font-semibold text-gray-800"},Z={key:0,class:"flex flex-col bg-white mt-5 rounded border overflow-auto"},ee=["onClick"],te={class:"flex flex-col w-full justify-center gap-2.5"},ae={class:"flex flex-row items-center justify-between"},se={class:"flex flex-row items-start gap-3 grow"},le={class:"flex flex-col items-start gap-1.5"},ne={class:"text-base font-normal text-gray-800"},oe={class:"text-xs font-normal text-gray-500"},ie=s("span",{class:"whitespace-pre"}," Â· ",-1),re={class:"whitespace-nowrap"},de={class:"flex flex-row justify-end items-center gap-2"},ce={class:"text-gray-700 font-normal rounded text-base"},ue={class:"bg-white w-full flex flex-col items-center justify-center pb-5"},xe={class:"w-full pt-8 pb-5 border-b text-center"},me={class:"text-gray-900 font-bold text-xl"},pe={class:"w-full flex flex-col items-center justify-center gap-5 p-4"},fe={class:"flex flex-col w-full space-y-4"},ve={key:0,class:"flex w-full flex-row items-center justify-between gap-3"},Ce={__name:"ExpenseTaxesTable",props:{expenseClaim:{type:Object,required:!0},currency:{type:String,required:!0},isReadOnly:{type:Boolean,default:!1}},emits:["add-expense-tax","update-expense-tax","delete-expense-tax"],setup(t,{emit:n}){const a=t,o=j({}),r=j(null),v=j(!1),w=(i,l)=>R(this,null,function*(){i&&(o.value=I({},i),r.value=l),v.value=!0}),y=()=>{n("delete-expense-tax",r.value),m()},c=()=>{r.value===null?n("add-expense-tax",o.value):n("update-expense-tax",o.value,r.value),m()};function m(){v.value=!1,o.value={},r.value=null}const T=G({url:"wms.api.get_doctype_fields",params:{doctype:"Expense Taxes and Charges"},transform(i){const l=["description_sb"],_=["cost_center","project","accounting_dimensions_section"];return a.id||l.push(..._),i.map(u=>(u.fieldname==="account_head"&&(u.linkFilters={company:a.expenseClaim.company,account_type:["in",["Tax","Chargeable","Income Account","Expenses Included In Valuation"]]}),u)).filter(u=>!l.includes(u.fieldname))}});T.reload();const S=N(()=>a.isReadOnly?"Expense Tax":r.value===null?"New Expense Tax":"Edit Expense Tax"),A=N(()=>{var i;return(i=T.data)==null?void 0:i.some(l=>{if(l.reqd&&!o.value[l.fieldname])return!0})});E(()=>o.value.account_head,i=>{o.value.description=i==null?void 0:i.split(" - ").slice(0,-1).join(" - ")}),E(()=>o.value.rate,(i,l)=>{r.value&&i&&!l||(o.value.tax_amount=parseFloat(a.expenseClaim.total_sanctioned_amount)*(parseFloat(i)/100),V())}),E(()=>o.value.tax_amount,i=>{V()});function V(){o.value.total=parseFloat(a.expenseClaim.total_sanctioned_amount)+parseFloat(o.value.tax_amount)}return(i,l)=>{var u;const _=H("Button");return t.expenseClaim.expenses?(d(),f(O,{key:0},[s("div",Q,[W,s("div",X,[s("span",Y,p(x(C)(t.expenseClaim.total_taxes_and_charges,t.currency)),1),t.isReadOnly?k("",!0):(d(),g(_,{key:0,id:"add-taxes-modal",class:"text-sm",icon:"plus",variant:"subtle",onClick:l[0]||(l[0]=e=>w())}))])]),(u=t.expenseClaim.taxes)!=null&&u.length?(d(),f("div",Z,[(d(!0),f(O,null,D(t.expenseClaim.taxes,(e,F)=>(d(),f("div",{class:"flex flex-row p-3.5 items-center justify-between border-b cursor-pointer",key:e.name,onClick:ye=>w(e,F)},[s("div",te,[s("div",ae,[s("div",se,[s("div",le,[s("div",ne,p(e.account_head),1),s("div",oe,[s("span",null," Rate: "+p(x(C)(e.rate,t.currency)),1),ie,s("span",re," Amount: "+p(x(C)(e.tax_amount,t.currency)),1)])])]),s("div",de,[s("span",ce,p(x(C)(e.total,t.currency)),1),h(x(B),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})])])])],8,ee))),128))])):(d(),g(K,{key:1,message:"No taxes added",isTableField:!0})),h(P,{isOpen:v.value,onDidDismiss:l[3]||(l[3]=e=>m())},{actionSheet:b(()=>[s("div",ue,[s("div",xe,[s("span",me,p(S.value),1)]),s("div",pe,[s("div",fe,[(d(!0),f(O,null,D(x(T).data,e=>(d(),g(J,{key:e.fieldname,class:"w-full",label:e.label,fieldtype:e.fieldtype,fieldname:e.fieldname,options:e.options,linkFilters:e.linkFilters,hidden:e.hidden,reqd:e.reqd,readOnly:e.read_only||t.isReadOnly,default:e.default,modelValue:o.value[e.fieldname],"onUpdate:modelValue":F=>o.value[e.fieldname]=F},null,8,["label","fieldtype","fieldname","options","linkFilters","hidden","reqd","readOnly","default","modelValue","onUpdate:modelValue"]))),128))]),t.isReadOnly?k("",!0):(d(),f("div",ve,[r.value!==null?(d(),g(_,{key:0,class:"border-red-600 text-red-600 py-5 text-sm",variant:"outline",theme:"red",onClick:l[1]||(l[1]=e=>y())},{prefix:b(()=>[h(x(B),{name:"trash",class:"w-4"})]),default:b(()=>[M(" Delete ")]),_:1})):k("",!0),h(_,{variant:"solid",class:"w-full py-5 text-sm disabled:bg-gray-700 disabled:text-white",onClick:l[2]||(l[2]=e=>c()),disabled:A.value},{prefix:b(()=>[h(x(B),{name:r.value===null?"plus":"check",class:"w-4"},null,8,["name"])]),default:b(()=>[M(" "+p(r.value===null?"Add Tax":"Update Tax"),1)]),_:1},8,["disabled"])]))])])]),_:1},8,["isOpen"])],64)):k("",!0)}}};export{Ce as default};
