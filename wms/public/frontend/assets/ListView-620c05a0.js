var oe=Object.defineProperty,se=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var j=(s,e,l)=>e in s?oe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[e]=l,D=(s,e)=>{for(var l in e||(e={}))ae.call(e,l)&&j(s,l,e[l]);if(L)for(var l of L(e))re.call(e,l)&&j(s,l,e[l]);return s},M=(s,e)=>se(s,le(e));var H=(s,e,l)=>new Promise((R,C)=>{var F=n=>{try{p(l.next(n))}catch(u){C(u)}},m=n=>{try{p(l.throw(n))}catch(u){C(u)}},p=n=>n.done?R(n.value):Promise.resolve(n.value).then(F,m);p((l=l.apply(s,e)).next())});import{a8 as I,a7 as ne,i as P,N as ie,a as w,c as B,M as ue,w as ce,b as fe,e as N,f as h,j as x,k as a,l as d,v as _,n as r,q as U,I as de,G as me,t as pe,F as z,E as ve,x as W,H as ye,$ as G,ay as ge,ax as we}from"./frappe-ui-cec019df.js";import{g as he,M as _e,N as be,h as ke,m as O}from"./index-0e5fa8f2.js";import xe from"./TabButtons-8724663b.js";import Ce from"./LeaveRequestItem-5f50263b.js";import Fe from"./ExpenseClaimItem-25e12d04.js";import Se from"./EmployeeAdvanceItem-01c7faac.js";import $e from"./ListFiltersActionSheet-f7e82892.js";import Be from"./CustomIonModal-3b018d4e.js";import{u as Re}from"./RequestList-787fbb4d.js";import{u as Ve}from"./realtime-0afd5b43.js";/* empty css                                                   */import"./EmployeeAvatar-0fff1228.js";import"./LeaveIcon-4c02e396.js";import"./leaves-3a895d25.js";import"./ExpenseIcon-2fe0be86.js";import"./RequestActionSheet.vue_vue_type_style_index_0_scoped_5369b918_lang-32e4c0e0.js";import"./formatters-e2b36d58.js";import"./EmployeeAdvanceIcon-5da1f595.js";import"./FormField-d154d136.js";const qe={class:"w-full sm:w-96"},Ie={class:"flex flex-row bg-white shadow-sm py-4 px-3 items-center justify-between border-b"},Ne={class:"flex flex-row items-center"},Te={class:"text-xl font-semibold text-gray-900"},Ee={class:"flex flex-row gap-2"},Ae={class:"w-full mt-5"},Le={key:0,class:"flex flex-col bg-white rounded mt-5"},je={key:2,class:"flex mt-2 items-center justify-center"},at={__name:"ListView",props:{doctype:{type:String,required:!0},fields:{type:Array,required:!0},groupBy:{type:String,required:!1},filterConfig:{type:Array,required:!0},tabButtons:{type:Array,required:!0},pageTitle:{type:String,required:!0}},setup(s){const e=s,l={"Leave Application":I(Ce),"Expense Claim":I(Fe),"Employee Advance":I(Se)},R=ne(),C=P("$socket"),F=P("$employee"),m=ie({}),p=w(e.tabButtons[0]),n=w(!1),u=w([]),S=w(null),T=w(null),V=w(!0),$=w({doctype:e.doctype,fields:e.fields,group_by:e.groupBy,order_by:`\`tab${e.doctype}\`.modified desc`,page_length:50}),E=B(()=>p.value===e.tabButtons[1]),J=B(()=>`${e.doctype.replace(/\s+/g,"")}FormView`),K=B(()=>`${e.doctype.replace(/\s+/g,"")}DetailView`),Q=B(()=>{const t=[];return E.value?t.push([e.doctype,"employee","!=",F.data.name]):t.push([e.doctype,"employee","=",F.data.name]),t}),c=ue({url:"frappe.desk.reportview.get",onSuccess:t=>{var o;((o=t.values)==null?void 0:o.length)<$.value.page_length&&(V.value=!1)},transform(t){if(t.length===0)return[];const o=t.keys,b=t.values.map(g=>{const k={};return o.forEach((i,q)=>{k[i]=g[q]}),k});let y;return!c.params.start||c.params.start===0?y=b:y=c.data.concat(b),y}});function A(){e.filterConfig.forEach(t=>{m[t.fieldname]={condition:"=",value:null}}),u.value=[]}A();function X(){let t="",o="";u.value=[];for(const f in m)t=m[f].condition,typeof t=="object"&&t!==null&&(t=t.value),o=m[f].value,t&&o&&u.value.push([e.doctype,f,t,o])}function Y(){X(),v(),O.dismiss(),n.value=!!u.value.length}function Z(){A(),v(),O.dismiss(),n.value=!1}function v(t=0){t===0&&(V.value=!0);const o=[[e.doctype,"docstatus","!=","2"]];o.push(...Q.value),u.value&&o.push(...u.value),S.value&&$.value.fields.push(S.value),c.submit(M(D({},$.value),{start:t||0,filters:o}))}const ee=we(()=>{if(!V.value)return;const{scrollTop:t,scrollHeight:o,clientHeight:f}=T.value;if(t/(o-f)*100>=90){const y=c.params.start+$.value.page_length;v(y)}},500),te=t=>{setTimeout(()=>{v(),t.target.complete()},500)};return ce(()=>p.value,t=>{v()}),fe(()=>H(this,null,function*(){const t=Re(e.doctype);yield t.workflowDoc.promise,S.value=t.getWorkflowStateField(),v(),Ve(C,e.doctype,()=>v())})),(t,o)=>{const f=N("Button"),b=N("router-link"),y=N("EmptyState");return h(),x(z,null,[a(r(he),{class:"ion-no-border"},{default:d(()=>[_("div",qe,[_("div",Ie,[_("div",Ne,[a(f,{variant:"ghost",class:"!pl-0 hover:bg-white",onClick:o[0]||(o[0]=g=>r(R).back())},{default:d(()=>[a(r(U),{name:"chevron-left",class:"h-5 w-5"})]),_:1}),_("h2",Te,de(s.pageTitle),1)]),_("div",Ee,[a(f,{id:"show-filter-modal",icon:"filter",variant:"subtle",class:me([n.value?"!border !border-gray-800 !bg-white !text-gray-900 !font-semibold":""])},null,8,["class"]),a(b,{to:{name:J.value}},{default:d(({navigate:g})=>[a(f,{variant:"solid",class:"mr-2",onClick:g},{prefix:d(()=>[a(r(U),{name:"plus",class:"w-4"})]),default:d(()=>[pe(" New ")]),_:2},1032,["onClick"])]),_:1},8,["to"])])])])]),_:1}),a(r(ke),null,{default:d(()=>{var g,k;return[a(r(_e),{slot:"fixed",onIonRefresh:o[1]||(o[1]=i=>te(i))},{default:d(()=>[a(r(be))]),_:1}),_("div",{class:"flex flex-col items-center mb-7 p-4 h-full w-full sm:w-96 overflow-y-auto",ref_key:"scrollContainer",ref:T,onScroll:o[3]||(o[3]=()=>r(ee)())},[_("div",Ae,[a(xe,{buttons:[{label:s.tabButtons[0]},{label:s.tabButtons[1]}],modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=i=>p.value=i)},null,8,["buttons","modelValue"]),!r(c).loading&&((g=r(c).data)!=null&&g.length)?(h(),x("div",Le,[(h(!0),x(z,null,ve(r(c).data,i=>(h(),x("div",{class:"p-3.5 items-center justify-between border-b cursor-pointer",key:i.name},[a(b,{to:{name:K.value,params:{id:i.name}}},{default:d(({navigate:q})=>[(h(),W(ye(l[s.doctype]),{doc:i,isTeamRequest:E.value,workflowStateField:S.value,onClick:q},null,8,["doc","isTeamRequest","workflowStateField","onClick"]))]),_:2},1032,["to"])]))),128))])):r(c).loading?G("",!0):(h(),W(y,{key:1,message:`No ${(k=e.doctype)==null?void 0:k.toLowerCase()}s found`},null,8,["message"])),r(c).loading?(h(),x("div",je,[a(r(ge),{class:"w-8 h-8 text-gray-800"})])):G("",!0)])],544),a(Be,{trigger:"show-filter-modal"},{actionSheet:d(()=>[a($e,{filterConfig:s.filterConfig,onApplyFilters:Y,onClearFilters:Z,filters:m,"onUpdate:filters":o[4]||(o[4]=i=>m=i)},null,8,["filterConfig","filters"])]),_:1})]}),_:1})],64)}}};export{at as default};
