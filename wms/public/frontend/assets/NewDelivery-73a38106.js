var v=(W,B,w)=>new Promise((y,x)=>{var C=d=>{try{q(w.next(d))}catch(I){x(I)}},D=d=>{try{q(w.throw(d))}catch(I){x(I)}},q=d=>d.done?y(d.value):Promise.resolve(d.value).then(C,D);q((w=w.apply(W,B)).next())});import{u as pe,a as n,a9 as K,w as U,x as z,l as M,n as c,f as o,v as t,t as R,I as r,k as u,q as _,a3 as E,a4 as T,aa as me,j as l,E as g,F as b,$ as X,H as Y,G as he}from"./frappe-ui-cec019df.js";import{I as ve,a as _e,q as ye}from"./index-0e5fa8f2.js";/* empty css                                                        */import fe from"./BaseLayout-ecda517c.js";/* empty css                                                   */import"./RequestActionSheet.vue_vue_type_style_index_0_scoped_5369b918_lang-32e4c0e0.js";import"./formatters-e2b36d58.js";import"./leaves-3a895d25.js";import"./claims-a7e597d7.js";import"./realtime-0afd5b43.js";import{Q as N}from"./quagga.min-73bcc46f.js";import{n as ge}from"./newdashbord-d3dab499.js";import{a as A}from"./axios-fc3df026.js";import"./notifications-0a235be6.js";const be={class:"flex flex-col items-center"},we=t("label",null,"Sales Order Number",-1),xe={class:"custom-select-wrapper"},Ce={class:"custom-input-wrapper"},qe={class:"custom-input"},Ie={class:"custom-options"},Pe={class:"custom-input-wrapper"},ke=["value","onClick"],Oe={id:"extra-data"},Se={key:1},Ne=["value"],De={id:"extra-data"},Qe={id:"addSummary",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},Le=t("p",null,"Picked Items",-1),Re={class:"flex flex-col gap-5 my-4 w-full"},Ee={class:"flex flex-col bg-white rounded"},Te={class:"flex flex-row items-center gap-3 grow"},Ae={class:"text-xs font-normal text-gray-800 leading-6"},Be={id:"circleii"},Fe={key:0,class:"add-form"},Ve=t("br",null,null,-1),je=t("label",{for:"itemName"},"Item",-1),Ue={class:"barcode-input"},ze={id:"searchName"},Me=["value"],We=t("br",null,null,-1),$e=t("label",{for:"itemName"},"Warehouse",-1),He={class:"barcode-input"},Ge={id:"searchWarehouse"},Je=["value"],Ke=t("br",null,null,-1),Xe=t("label",{for:"itemName"},"Quantity",-1),Ye=t("br",null,null,-1),Ze=t("br",null,null,-1),et=t("div",{id:"barcodeScanner"},null,-1),tt=[et],at={class:"flex flex-col gap-5 my-4 w-full"},st={class:"flex flex-col bg-white rounded"},ot={class:"flex flex-row items-center gap-3 grow"},rt={class:"text-sm font-normal text-gray-800 leading-6"},nt={id:"circleii"},Ct={__name:"NewDelivery",setup(W){const B=pe(),w=[{icon:ye,title:"Request QC",route:"/ReceivePage"},{icon:ge,title:"Print Labels",route:"/dashboard/expense-claims"}];n(!1);const y=n(!1);n("");const x=n(!1),C=()=>v(this,null,function*(){y.value=!1}),D=()=>v(this,null,function*(){y.value=!1,x.value=!0;try{yield q(),d()}catch(s){console.error("Error loading Quagga:",s)}}),q=()=>new Promise((s,a)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=s,e.onerror=a,document.head.appendChild(e)}),d=()=>{N.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(s){if(s){console.error(s);return}N.start()})},I=()=>{x.value=!1,N&&N.stop&&N.stop()},$=()=>{y.value=!y.value},Z=()=>{router.push({name:"ReceivePage"})},ee=K({doctype:"Purchase Order",fields:["*"],auto:!0}),te=K({doctype:"Warehouse",fields:["*"],auto:!0}),H=n([]);U(()=>te.data,s=>{if(s&&Array.isArray(s)){const a=s.filter(e=>e.is_group===0);H.value=a.map(e=>e.name)}});const p=n(""),P=n(""),m=n(""),f=n(""),F=n(""),k=n([]),O=n([]),h=n({});U(f,s=>v(this,null,function*(){s&&(yield ae(s))}));const ae=s=>v(this,null,function*(){try{const a=yield A.get("/api/method/wms.api.my_api.list_of_items",{params:{po_name:s}});a.data&&a.data.message?(k.value=a.data.message,h.value={},k.value.forEach(e=>{h.value[e.item_code]=e.quantity})):console.error("Invalid response data:",a.data)}catch(a){console.error("Error fetching item data:",a)}});(()=>v(this,null,function*(){try{const s=yield A.get("/api/method/wms.api.my_api.list_of_purchase",{});O.value=s.data.message,console.log("data",O.value)}catch(s){console.log("error::::",error.result)}}))(),U(p,s=>{const a=k.value.find(e=>e.item_code===s);P.value=a?a.warehouse:"",m.value=a?a.quantity:"",F.value=a?a.uom:"",m.value=h.value[s],h.value[s]===0&&(p.value="")});const Q=n([]),G=()=>{const s=h.value[p.value];if(s>0&&m.value<=s){const a=p.value,e=m.value,i=P.value,de=F.value;Q.value.push({itemCode:a,quantity:e,warehouse:i,uom:de}),h.value[a]-=e,console.log("qtyyyy",h.value[a]),h.value[a]===0&&(p.value=""),V()}else console.log("Invalid quantity or no remaining quantity. Cannot add more items.")},se=()=>{J()?(G(),V()):alert("Invalid quantity entered.")},oe=()=>{J()?(G(),V(),$()):alert("Invalid quantity entered")},V=()=>{p.value="",m.value="",P.value="",F.value=""},S=n([]);S.value=O.value;const re=s=>{const a=s.trim().toLowerCase();if(!a){S.value=O.value;return}S.value=O.value.filter(e=>e.name.toLowerCase().includes(a)||e.supplier.toLowerCase().includes(a)||e.company.toLowerCase().includes(a))};function ne(){document.querySelector(".custom-options").classList.toggle("active")}const le=n(""),ie=s=>{f.value=s,console.log("selectedValue",le.value)},J=()=>{const s=k.value.find(i=>i.item_code===p.value),a=s?parseInt(s.quantity):0,e=parseInt(m.value);return e>0&&e<=a};let j=n("New"),L=!1;const ce=()=>v(this,null,function*(){try{if(L)throw new Error("Purchase receipt has already been created for this data");const s=f.value;if(!s){console.error("Purchase order name is undefined");return}const a={name:s,items:Q.value.map(i=>({warehouse:i.warehouse,item_code:i.itemCode,qty:parseInt(i.quantity),uom:i.uom}))};console.log("Request Data:",a);const e=yield A.post("/api/method/wms.api.my_api.create_purchase_receipt",a);alert("Purchase receipt created:",e.data.message),L=!0,j.value=e.data.message}catch(s){console.error("Error creating purchase receipt:",s.response)}}),ue=()=>v(this,null,function*(){try{if(L)throw new Error("Purchase receipt has already been created for this data");const s=f.value;if(!s){console.error("Purchase order name is undefined");return}const a={name:s,items:Q.value.map(i=>({warehouse:i.warehouse,item_code:i.itemCode,qty:parseInt(i.quantity),uom:i.uom}))};console.log("Request Data:",a);const e=yield A.post("/api/method/wms.api.my_api.submit_and_create_purchase_receipt",a);console.log("Purchase receipt created:",e.data),L=!0,j.value=e.data.message}catch(s){console.error("Error creating purchase receipt:",s.response)}});return(s,a)=>(o(),z(fe,{pageTitle:c(j),home:"shopping-cart",onCartIconClick:Z,class:"text-xs"},{body:M(()=>[t("div",be,[t("div",{onClick:C,id:"purchaseDateII",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},[we,t("div",xe,[t("div",{class:"custom-select",onClick:ne},[t("div",Ce,[t("div",qe,[R(r(f.value)+" ",1),u(c(_),{name:"chevron-down",class:"h-6 w-6 text-black-500 cursor-pointer ml-auto"})])]),t("div",Ie,[t("div",Pe,[E(t("input",{type:"text",placeholder:"Type here...",onClick:a[0]||(a[0]=me(()=>{},["stop"])),onInput:a[1]||(a[1]=e=>re(e.target.value)),"onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e),id:"searchPurchaseOrder"},null,544),[[T,f.value]])]),!s.searchInput||S.value.length>0?(o(!0),l(b,{key:0},g(S.value,e=>(o(),l("div",{key:e.title,value:e.name,class:"custom-option",onClick:()=>ie(e.name)},[t("p",null,r(e.name),1),t("p",Oe,[R(r(e.supplier)+", ",1),t("span",null,r(e.company),1)])],8,ke))),128)):(o(),l("div",Se,[(o(!0),l(b,null,g(c(ee).data,e=>(o(),l("div",{key:e.title,value:e.name,class:"custom-option"},[t("p",null,r(e.name),1),t("p",De,[R(r(e.supplier)+", ",1),t("span",null,r(e.company),1)])],8,Ne))),128))]))])])])]),t("div",Qe,[Le,u(c(_),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:$})]),t("div",Re,[t("div",Ee,[(o(!0),l(b,null,g(Q.value,(e,i)=>(o(),l("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:i},[t("div",Te,[u(c(_),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),t("div",Ae,[t("p",null,r(e.purchaseOrder),1),t("p",null,r(e.itemCode)+" | "+r(e.warehouse),1)]),t("div",Be,r(e.quantity),1)]),u(c(_),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),y.value?(o(),l("div",Fe,[t("div",{onClick:C,id:"space"},[t("div",{onClick:C,id:"scrollerLine"})]),Ve,je,t("div",Ue,[E(t("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>p.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[T,p.value]]),t("datalist",ze,[(o(!0),l(b,null,g(k.value,e=>(o(),l("option",{key:e.title,value:e.name},r(e.item_code),9,Me))),128))]),R(),t("span",{class:"barcode-scanner",onClick:D},[u(c(_),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),We,$e,t("div",He,[E(t("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":a[4]||(a[4]=e=>P.value=e)},null,512),[[T,P.value]]),t("datalist",Ge,[(o(!0),l(b,null,g(H.value,e=>(o(),l("option",{key:e,value:e},r(e),9,Je))),128))]),t("span",{class:"barcode-scanner",onClick:D},[u(c(_),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),Ke,Xe,E(t("input",{"onUpdate:modelValue":a[5]||(a[5]=e=>m.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[T,m.value]]),Ye,t("button",{id:"addNew",onClick:se},"Submit and Add New"),Ze,t("button",{id:"sub",onClick:oe},"Submit ")])):X("",!0),x.value?(o(),l("div",{key:1,class:"barcode-scanner-container",onClick:I},tt)):X("",!0),t("div",at,[t("div",st,[(o(!0),l(b,null,g(s.submittedData,e=>(o(),l("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[t("div",ot,[(o(),z(Y(e.icon),{class:"h-5 w-5 text-gray-500"})),u(c(_),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),t("div",rt,[t("p",null,r(e.purchaseOrder),1),t("p",null,r(e.itemCode)+"| "+r(e.warehouse),1)]),t("div",nt,r(e.uom),1)]),u(c(_),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),t("div",{id:"btnDiv",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},[t("button",{id:"submitPurchaseReceipt",onClick:ue},"Submit"),t("button",{id:"savePurchaseReceipt",onClick:ce},"Save")])]),u(c(_e),{slot:"bottom",class:"bg-white shadow-md sm:w-96 py-2 standalone:pb-safe-bottom"},{default:M(()=>[(o(),l(b,null,g(w,e=>u(c(ve),{key:e.title,tab:e.title,href:e.route,class:he(["bg-white text-xs space-y-1.5 !hover:border-gray-300 !hover:text-gray-700 transition active:scale-95",c(B).path===e.route?"border-gray-900 text-gray-800 font-semibold":"text-gray-600 font-normal"])},{default:M(()=>[(o(),z(Y(e.icon),{class:"h-5 w-5"})),t("div",null,r(e.title),1)]),_:2},1032,["tab","href","class"])),64))]),_:1})]),_:1},8,["pageTitle"]))}};export{Ct as default};
