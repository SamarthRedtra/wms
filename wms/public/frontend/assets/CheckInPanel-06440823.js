import{i as h,a as I,a9 as N,c as d,b as j,af as B,e as D,f as k,j as b,v as c,I as a,n as l,$ as T,k as u,l as f,q as E,t as C,F as S,ae as g}from"./frappe-ui-cec019df.js";import{j as V,m as H}from"./index-0e5fa8f2.js";const O={class:"flex flex-col bg-white rounded w-full py-6 px-4 border-none"},F={class:"text-lg font-bold text-gray-900"},P={key:0,class:"font-medium text-sm text-gray-500 mt-1.5"},U={class:"h-40 w-full flex flex-col items-center justify-center gap-5 p-4 mb-5"},q={class:"flex flex-col gap-1.5 items-center justify-center"},A={class:"font-bold text-xl"},R={class:"font-medium text-gray-500 text-sm"},p="Employee Checkin",K={__name:"CheckInPanel",setup(z){const r=h("$socket"),_=h("$employee"),o=h("$dayjs"),y=I(null),n=N({doctype:p,fields:["name","employee","employee_name","log_type","time","device_id"],filters:{employee:_.data.name},orderBy:"time desc"});n.reload();const s=d(()=>n.list.loading||!n.data?{}:n.data[0]),Y=d(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?"check-in":"check-out"}),m=d(()=>{var e;return((e=s==null?void 0:s.value)==null?void 0:e.log_type)==="IN"?{action:"OUT",label:"Check Out"}:{action:"IN",label:"Check In"}}),$=d(()=>{var i;const e=(i=s==null?void 0:s.value)==null?void 0:i.time,t=o(e).format("hh:mm a");return o(e).isToday()?t:o(e).isYesterday()?`${t} yesterday`:o(e).isSame(o(),"year")?`${t} on ${o(e).format("D MMM")}`:`${t} on ${o(e).format("D MMM, YYYY")}`}),M=e=>{const t=e==="IN"?"Check-in":"Check-out";n.insert.submit({employee:_.data.name,log_type:e,time:y.value},{onSuccess(){H.dismiss(),g({title:"Success",text:`${t} successful!`,icon:"check-circle",position:"bottom-center",iconClasses:"text-green-500"})},onError(){g({title:"Error",text:`${t} failed!`,icon:"alert-circle",position:"bottom-center",iconClasses:"text-red-500"})}})};return j(()=>{r.emit("doctype_subscribe",p),r.on("list_update",e=>{e.doctype==p&&n.reload()})}),B(()=>{r.emit("doctype_unsubscribe",p),r.off("list_update")}),(e,t)=>{var x,v;const i=D("Button");return k(),b(S,null,[c("div",O,[c("h2",F," Hey, "+a((v=(x=l(_))==null?void 0:x.data)==null?void 0:v.first_name)+" ðŸ‘‹ ",1),s.value?(k(),b("div",P," Last "+a(Y.value)+" was at "+a($.value),1)):T("",!0),u(i,{class:"mt-4 mb-1 drop-shadow-sm py-5 text-base",id:"open-checkin-modal",onClick:t[0]||(t[0]=w=>y.value=l(o)().format("YYYY-MM-DD HH:mm:ss"))},{prefix:f(()=>[u(l(E),{name:m.value.action==="IN"?"arrow-right-circle":"arrow-left-circle",class:"w-4"},null,8,["name"])]),default:f(()=>[C(" "+a(m.value.label),1)]),_:1})]),u(l(V),{ref:"modal",trigger:"open-checkin-modal","initial-breakpoint":1,breakpoints:[0,1]},{default:f(()=>[c("div",U,[c("div",q,[c("div",A,a(l(o)(y.value).format("hh:mm:ss a")),1),c("div",R,a(l(o)().format("D MMM, YYYY")),1)]),u(i,{variant:"solid",class:"w-full py-5 text-sm",onClick:t[1]||(t[1]=w=>M(m.value.action))},{default:f(()=>[C(" Confirm "+a(m.value.label),1)]),_:1})])]),_:1},512)],64)}}};export{K as default};
