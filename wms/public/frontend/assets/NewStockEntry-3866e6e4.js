var Ee=Object.defineProperty;var te=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var ae=(_,c,r)=>c in _?Ee(_,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):_[c]=r,se=(_,c)=>{for(var r in c||(c={}))Ne.call(c,r)&&ae(_,r,c[r]);if(te)for(var r of te(c))Ie.call(c,r)&&ae(_,r,c[r]);return _};var h=(_,c,r)=>new Promise((R,w)=>{var M=i=>{try{D(r.next(i))}catch(A){w(A)}},u=i=>{try{D(r.throw(i))}catch(A){w(A)}},D=i=>i.done?R(i.value):Promise.resolve(i.value).then(M,u);D((r=r.apply(_,c)).next())});import{u as qe,a as o,a9 as oe,w as re,c as ne,ac as je,b as Le,x as le,l as Re,n as x,f as n,v as s,a3 as S,ad as G,j as l,E as j,I as m,F as L,k as C,q as E,a6 as Ae,a4 as B,t as Me,$ as ce,H as De}from"./frappe-ui-63c927c1.js";import Pe from"./BaseLayout-fcc95c5f.js";import{Q as O}from"./quagga.min-a38e8bb9.js";import{a as N}from"./axios-fc3df026.js";import{u as Qe}from"./index-fbc0966c.js";import"./index-1774bd7d.js";import"./notifications-4b74d839.js";const Ue={class:"flex flex-col items-center"},Oe=s("p",null,"Stock Entry Type",-1),Te=s("option",{value:""},null,-1),$e=s("option",{value:"Material Receipt"},"Material Receipt",-1),Be=s("option",{value:"Material Transfer"},"Material Transfer",-1),Ve=s("option",{value:"Material Issue"},"Material Issue",-1),ze=[Te,$e,Be,Ve],We=s("p",null,"Company",-1),Fe=["value"],He=s("p",null,"Project",-1),Je=["value"],Ge={id:"addSummary",class:"text-base leading-6 rounded py-6 px-4 border-none",style:{width:"90%"}},Ke=s("p",null,"Stock Entries",-1),Xe={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},Ye={class:"flex flex-col bg-white rounded"},Ze=["onClick"],et={class:"flex flex-row items-center gap-3 grow"},tt={class:"text-xs font-normal text-gray-800 leading-6"},at={id:"circleii"},st={id:"reader"},ot={key:0,class:"add-form"},rt=s("br",null,null,-1),nt=s("label",{for:"itemName"},"Item",-1),lt={class:"barcode-input"},ct={id:"searchName"},ut=["value"],it=s("br",null,null,-1),dt=s("label",{for:"itemName"},"Source Warehouse",-1),vt={class:"barcode-input"},mt={id:"searchWarehouse"},pt=["value"],ht=s("br",null,null,-1),_t=s("label",{for:"itemName"},"Target Warehouse",-1),yt={class:"barcode-input"},ft={id:"searchWarehouse"},wt=["value"],gt=s("br",null,null,-1),bt=s("label",{for:"itemName"},"Quantity",-1),xt=s("br",null,null,-1),kt=s("br",null,null,-1),St=s("div",{id:"barcodeScanner"},null,-1),Ct=[St],Et={class:"flex flex-col gap-5 my-4 w-full"},Nt={class:"flex flex-col bg-white rounded"},It={class:"flex flex-row items-center gap-3 grow"},qt={class:"text-sm font-normal text-gray-800 leading-6"},jt={id:"circleii"},Bt={__name:"NewStockEntry",setup(_){const{cookies:c}=Qe(),r=qe(),R=o("");R.value=r.query.stName,console.log("stName",R.value),o(!1);const w=o(!1);o("");const M=o(!1),u=o({}),D=t=>{u.value=se({},t),y.value=t.itemCode,g.value=t.warehouse,b.value=t.twarehouse,p.value=t.quantity,w.value=!0},i=()=>h(this,null,function*(){w.value=!1,U.value=!1}),A=()=>h(this,null,function*(){w.value=!1,M.value=!0;try{yield ue(),ie()}catch(t){console.error("Error loading Quagga:",t)}}),ue=()=>new Promise((t,a)=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js",e.onload=t,e.onerror=a,document.head.appendChild(e)}),ie=()=>{O.init({inputStream:{name:"Live",type:"LiveStream",target:document.querySelector("#barcodeScanner")},decoder:{readers:["ean_reader"]}},function(t){if(t){console.error(t);return}O.start()})},de=()=>{M.value=!1,O&&O.stop&&O.stop()},K=()=>{w.value=!w.value,U.value=!1},ve=()=>{window.location.href="/StockCount"};oe({doctype:"Purchase Order",fields:["*"],auto:!0});const me=oe({doctype:"Warehouse",fields:["*"],auto:!0}),V=o([]);re(()=>me.data,t=>{if(t&&Array.isArray(t)){const a=t.filter(e=>e.is_group===0);V.value=a.map(e=>e.name)}});const y=o(""),g=o(""),b=o(""),p=o(0),pe=o(""),he=o(""),_e=o([]),ye=o([]);o({});const z=o([]);(()=>h(this,null,function*(){try{const t=yield N.get("/api/method/wms.api.my_api.get_all_items");z.value=t.data.message,console.log("itemList data",z.value)}catch(t){console.error("Error fetching warehouse:",t)}}))();const W=o([]);(()=>h(this,null,function*(){try{const t=yield N.get('/api/resource/Project?fields=["name","project_name"]');console.log(t.data.data.map(a=>a.name),"project list"),W.value=t.data.data,console.log("projectList data",W.value)}catch(t){console.error("Error fetching warehouse:",t)}}))();const F=o([]);(()=>h(this,null,function*(){try{const t=yield N.get("/api/method/wms.api.my_api.get_all_company");F.value=t.data.message,console.log("companyList data",F.value)}catch(t){console.error("Error fetching warehouse:",t)}}))(),re(pe,t=>h(this,null,function*(){t&&(yield fetchItemData(t))}));const k=o([]),X=()=>{const t=y.value,a=g.value,e=b.value,v=Number(p.value),q=k.value.find(J=>J.itemCode===t&&J.warehouse===a&&J.twarehouse===e);q?q.quantity+=v:k.value.push({itemCode:t,warehouse:a,twarehouse:e,quantity:v}),H()},Y=()=>y.value.trim()!==""&&g.value.trim()!==""&&b.value.trim()!==""&&p.value!==null&&!isNaN(p.value)&&p.value>0,fe=()=>{if(Y()){if(u.value.itemCode){const t=k.value.find(a=>a.itemCode===u.value.itemCode&&a.warehouse===u.value.warehouse&&a.twarehouse===u.value.twarehouse);t&&(t.quantity=p.value,t.warehouse=g.value,t.twarehouse=b.value,t.itemCode=y.value)}else X();H(),u.value={}}},we=()=>{if(Y()){if(u.value.itemCode){const t=k.value.find(a=>a.itemCode===u.value.itemCode&&a.warehouse===u.value.warehouse&&a.twarehouse===u.value.twarehouse);t&&(t.quantity=p.value,t.warehouse=g.value,t.twarehouse=b.value,t.itemCode=y.value)}else X();H(),K(),u.value={}}},H=()=>{y.value="",p.value="",g.value="",b.value="",he.value=""},ge=o([]);ge.value=ye.value,o("");let d=o("New");const P=o(""),Q=o(""),I=o(""),U=o(!1),T=o(""),be=()=>{U.value=!0;const t=new Html5Qrcode("reader");t.start({facingMode:"environment"},a=>{console.log("QR code scanned:",a),alert("QR code scanned: "+a),ee(T.value),Z(t)},a=>{T.value=a,alert(" QR code: "+T.value),ee(T.value),Z(t)})},Z=t=>{U.value=!1,t.stop()},$=o(""),ee=t=>h(this,null,function*(){try{const a=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${t}`);if(!a.ok)throw new Error("Network response was not ok");const e=yield a.json();return $.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(a){return console.error("Error fetching item details:",a),null}}),xe=ne(()=>{const t=new Set;return _e.value.filter(a=>{const e=t.has(a.name);return t.add(a.name),!e})});ne(()=>xe.value.some(t=>t.name===$.value)),je(()=>{$.value&&(y.value=$.value)}),console.log("stName",R);const f=o([]),ke=()=>h(this,null,function*(){try{const t=yield N.get("/api/method/wms.api.my_api.get_stockentry_by_name",{params:{name:R.value}});if(f.value=t.data.message,console.log("apiData",f.value),t.data&&t.data.message&&(Q.value=f.value.stock_entry_type||"",P.value=f.value.company||"",f.value.items&&f.value.items.length>0)){const a=f.value.items[0];y.value=a.item_code||"",g.value=a.s_warehouse||"",b.value=a.t_warehouse||"",p.value=a.qty||"",I.value=(a==null?void 0:a.project)||""}f.value?(d.value=f.value.name,f.value.items.forEach(a=>{k.value.push({itemCode:a.item_code,warehouse:a.s_warehouse,twarehouse:a.t_warehouse,quantity:a.qty})})):console.error("Invalid response data:",t.data)}catch(t){console.log("Error while fetching data",t.response)}});Le(()=>{r.query.stName&&ke()});const Se=()=>h(this,null,function*(){const t=c.get("sid"),a={company:P.value,stock_entry_type:Q.value,project:I.value,items:k.value.map(e=>({item_code:e.itemCode,s_warehouse:e.warehouse,t_warehouse:e.twarehouse,qty:e.quantity,project:I.value})),docstatus:0};try{if(d.value&&d.value!=="New"){const e=yield N.put(`/api/resource/Stock Entry/${d.value}`,a,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Entry",e.data),alert("Updated Stock Entry: "+e.data.data.name)}else{const e=yield N.post("/api/resource/Stock Entry",a,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Entry",e.data),d.value=e.data.data.name,alert("Created Stock Entry: "+d.value)}}catch(e){console.error("Error in Stock Entry process:",e);try{const v=JSON.parse(e.response.data._server_messages),q=JSON.parse(v[0]);alert(q.message)}catch(v){console.error("Error parsing server message:",v),alert("An unexpected error occurred.")}}}),Ce=()=>h(this,null,function*(){const t=c.get("sid"),a={company:P.value,stock_entry_type:Q.value,project:I.value,items:k.value.map(e=>({item_code:e.itemCode,s_warehouse:e.warehouse,t_warehouse:e.twarehouse,qty:e.quantity,project:I.value})),docstatus:1};try{if(d.value&&d.value!=="New"){const e=yield N.put(`/api/resource/Stock Entry/${d.value}`,a,{headers:{Authorization:`Bearer ${t}`}});console.log("Updated Stock Entry",e.data),alert("Updated Stock Entry: "+e.data.data.name)}else{const e=yield N.post("/api/resource/Stock Entry",a,{headers:{Authorization:`Bearer ${t}`}});console.log("Created Stock Entry",e.data),d.value=e.data.data.name,alert("Created Stock Entry: "+d.value)}}catch(e){console.error("Error in Stock Entry process:",e);try{const v=JSON.parse(e.response.data._server_messages),q=JSON.parse(v[0]);alert(q.message)}catch(v){console.error("Error parsing server message:",v),alert("An unexpected error occurred.")}}});return(t,a)=>(n(),le(Pe,{pageTitle:x(d),home:"layers",onCartIconClick:ve,class:"text-xs"},{body:Re(()=>[s("div",Ue,[s("div",{onClick:i,id:"containerIII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none mt-5"},[Oe,S(s("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>Q.value=e)},ze,512),[[G,Q.value]])]),s("div",{onClick:i,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[We,S(s("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e)},[(n(!0),l(L,null,j(F.value,e=>(n(),l("option",{key:e.name,value:e.name},m(e.name),9,Fe))),128))],512),[[G,P.value]])]),s("div",{onClick:i,id:"containerII",class:"flex justify-between text-base leading-6 rounded w-full py-1 px-4 border-none"},[He,S(s("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>I.value=e)},[(n(!0),l(L,null,j(W.value,e=>(n(),l("option",{key:e.name,value:e.name},m(e.project_name+" ("+e.name+")"),9,Je))),128))],512),[[G,I.value]])]),s("div",Ge,[Ke,C(x(E),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:K})]),s("div",Xe,[s("div",Ye,[(n(!0),l(L,null,j(k.value,(e,v)=>(n(),l("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:v,onClick:q=>D(e)},[s("div",et,[C(x(E),{name:"shopping-bag",class:"h-5 w-5 text-gray-500"}),s("div",tt,[s("p",null,m(e.itemCode)+" | "+m(e.warehouse),1),s("p",null,m(e.twarehouse),1)]),s("div",at,m(e.quantity),1)]),C(x(E),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})],8,Ze))),128))])]),S(s("div",st,null,512),[[Ae,U.value]]),w.value?(n(),l("div",ot,[s("div",{onClick:i,id:"space"},[s("div",{onClick:i,id:"scrollerLine"})]),rt,nt,s("div",lt,[S(s("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>y.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[B,y.value]]),s("datalist",ct,[(n(!0),l(L,null,j(z.value,e=>(n(),l("option",{key:e.name,value:e.name},m(e.name),9,ut))),128))]),Me(),s("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:be},[C(x(E),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),it,dt,s("div",vt,[S(s("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e)},null,512),[[B,g.value]]),s("datalist",mt,[(n(!0),l(L,null,j(V.value,e=>(n(),l("option",{key:e,value:e},m(e),9,pt))),128))]),s("span",{class:"barcode-scanner",onClick:A},[C(x(E),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),ht,_t,s("div",yt,[S(s("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e)},null,512),[[B,b.value]]),s("datalist",ft,[(n(!0),l(L,null,j(V.value,e=>(n(),l("option",{key:e,value:e},m(e),9,wt))),128))]),s("span",{class:"barcode-scanner",onClick:A},[C(x(E),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),gt,bt,S(s("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>p.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[B,p.value]]),xt,s("button",{id:"addNew",onClick:fe},"Submit and Add New"),kt,s("button",{id:"sub",onClick:we},"Submit ")])):ce("",!0),M.value?(n(),l("div",{key:1,class:"barcode-scanner-container",onClick:de},Ct)):ce("",!0),s("div",Et,[s("div",Nt,[(n(!0),l(L,null,j(t.submittedData,e=>(n(),l("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[s("div",It,[(n(),le(De(e.icon),{class:"h-5 w-5 text-gray-500"})),C(x(E),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),s("div",qt,[s("p",null,m(e.itemCode)+"| "+m(e.warehouse),1)]),s("div",jt,m(e.quantity),1)]),C(x(E),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),s("div",{id:"btnDiv",class:"w-full flex justify-around sm:w-96 py-2 standalone:pb-safe-bottom"},[s("button",{id:"submitPurchaseReceipt",onClick:Ce},"Submit"),s("button",{id:"savePurchaseReceipt",onClick:Se},"Save")])])]),_:1},8,["pageTitle"]))}};export{Bt as default};
