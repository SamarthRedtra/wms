var p=(K,O,u)=>new Promise((M,T)=>{var C=v=>{try{w(u.next(v))}catch(k){T(k)}},$=v=>{try{w(u.throw(v))}catch(k){T(k)}},w=v=>v.done?M(v.value):Promise.resolve(v.value).then(C,$);w((u=u.apply(K,O)).next())});import{u as Ie,a as o,a9 as ie,w as W,c as ce,ac as Ne,b as Pe,x as H,l as J,n as c,f as r,v as s,k as h,q as g,I as n,a3 as L,a4 as V,aa as Se,j as i,F as b,E as x,t as G,a6 as Oe,$ as ue,H as de,G as De}from"./frappe-ui-cec019df.js";import{I as Re,a as Ee,q as Qe}from"./index-0e5fa8f2.js";/* empty css                                                        */import Le from"./BaseLayout-ecda517c.js";/* empty css                                                   */import"./RequestActionSheet.vue_vue_type_style_index_0_scoped_5369b918_lang-32e4c0e0.js";import"./formatters-e2b36d58.js";import"./leaves-3a895d25.js";import"./claims-a7e597d7.js";import"./realtime-0afd5b43.js";import{Q as Y}from"./quagga.min-73bcc46f.js";import{n as Te}from"./newdashbord-d3dab499.js";import{a as S}from"./axios-fc3df026.js";import"./notifications-0a235be6.js";const $e={class:"flex flex-col items-center"},Ae=s("label",null,"Purchase Order Number",-1),Be={class:"custom-select-wrapper"},Fe={class:"custom-input-wrapper"},Ve={class:"custom-input"},Me={id:"selectP"},Ue={class:"custom-options"},je={class:"custom-input-wrapper"},ze={key:0,id:"custom-input",class:"custom-input"},We=["onClick"],He={id:"extra-data"},Je={key:1,id:"custom-input",class:"custom-input"},Ge=["onClick"],Ye={class:"extra-data"},Ke={id:"addSummary",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},Xe=s("p",null,"Picked Items",-1),Ze={class:"flex flex-col gap-5 my-4",style:{width:"90%"}},et={class:"flex flex-col bg-white rounded"},tt={class:"flex flex-row items-center gap-3 grow"},at={class:"text-xs font-normal text-gray-800 leading-6"},st={id:"circleii"},ot={id:"reader"},rt={key:0,class:"add-form"},nt=s("br",null,null,-1),lt=s("label",{for:"itemName"},"Item",-1),it={class:"barcode-input"},ct={id:"searchName"},ut=["value"],dt=s("br",null,null,-1),pt=s("label",{for:"itemName"},"Warehouse",-1),mt={class:"barcode-input"},ht={id:"searchWarehouse"},vt=["value"],_t=s("br",null,null,-1),ft=s("label",{for:"itemName"},"Quantity",-1),yt=s("br",null,null,-1),gt=s("br",null,null,-1),wt=s("div",{id:"barcodeScanner"},null,-1),bt=[wt],xt={class:"flex flex-col gap-5 my-4 w-full"},Ct={class:"flex flex-col bg-white rounded"},kt={class:"flex flex-row items-center gap-3 grow"},qt={class:"text-sm font-normal text-gray-800 leading-6"},It={id:"circleii"},Nt=s("button",{id:"DraftReceipt"},"Submit Draft Receipt",-1),jt={__name:"FormView",setup(K){const O=Ie(),u=o("");u.value=O.query.linkName;const M=[{icon:Qe,title:"Request QC",route:"/QualityInspection"},{icon:Te,title:"Print Labels",route:"/PrintLab"}],T=a=>{a.title==="Request QC"&&qe()};o(!1);const C=o(!1);o("");const $=o(!1),w=()=>p(this,null,function*(){C.value=!1,R.value=!1}),v=()=>{$.value=!1,Y&&Y.stop&&Y.stop()},k=()=>{C.value=!C.value,R.value=!1},pe=()=>{router.push({name:"ReceivePage"})};ie({doctype:"Purchase Order",fields:["*"],auto:!0});const me=ie({doctype:"Warehouse",fields:["*"],auto:!0}),X=o([]);W(()=>me.data,a=>{if(a&&Array.isArray(a)){const t=a.filter(e=>e.is_group===0);X.value=t.map(e=>e.name)}});const d=o(""),q=o(""),m=o(""),_=o(""),U=o(""),I=o([]),N=o([]),P=o({});W(_,a=>p(this,null,function*(){a&&(yield he(a))}));const he=a=>p(this,null,function*(){try{const t=yield S.get("/api/method/wms.api.my_api.list_of_items",{params:{po_name:a}});t.data&&t.data.message?(I.value=t.data.message,P.value={},I.value.forEach(e=>{P.value[e.item_code]=e.quantity})):console.error("Invalid response data:",t.data)}catch(t){console.error("Error fetching item data:",t)}});(()=>p(this,null,function*(){try{const a=yield S.get("/api/method/wms.api.my_api.list_of_purchase",{});N.value=a.data.message,console.log("data",N.value)}catch(a){console.log("error::::",error.result)}}))(),W(d,a=>{const t=I.value.find(e=>e.item_code===a);q.value=t?t.warehouse:"",m.value=t?t.quantity:"",U.value=t?t.uom:"",m.value=P.value[a],P.value[a]===0&&(d.value="")});const f=o([]),Z=()=>{const a=P.value[d.value];if(a>0&&m.value<=a){const t=f.value.findIndex(e=>e.itemCode===d.value);if(t!==-1)f.value[t].quantity+=parseInt(m.value);else{const e=d.value,l=m.value,y=q.value,z=U.value;f.value.push({itemCode:e,quantity:l,warehouse:y,uom:z})}P.value[d.value]-=parseInt(m.value),j()}else console.log("Invalid quantity or no remaining quantity. Cannot add more items.")},ve=()=>{te()?(Z(),j()):alert("Invalid quantity entered.")},_e=()=>{te()?(Z(),j(),k()):alert("Invalid quantity entered")},j=()=>{d.value="",m.value="",q.value="",U.value=""},A=o([]);A.value=N.value;const fe=a=>{const t=a.trim().toLowerCase();if(!t){A.value=N.value;return}A.value=N.value.filter(e=>e.name.toLowerCase().includes(t)||e.supplier.toLowerCase().includes(t)||e.company.toLowerCase().includes(t))};function ye(){document.querySelector(".custom-options").classList.toggle("active")}const ge=o(""),ee=a=>{_.value=a,console.log("selectedValue",ge.value)},te=()=>{const a=I.value.find(l=>l.item_code===d.value),t=a?parseInt(a.quantity):0,e=parseInt(m.value);return e>0&&e<=t};let D=o("New"),ae=!1,se=!1,we=null;const be=()=>p(this,null,function*(){try{if(ae)throw new Error("Purchase receipt has already been created for this data");const a=_.value;if(!a){console.error("Purchase order name is undefined");return}const t={po_name:a,pr:u.value,items:f.value.map(y=>({item_code:y.itemCode,warehouse:y.warehouse,qty:parseInt(y.quantity),uom:y.uom}))};console.log("Request Data:",t);const e=yield S.post("/api/method/wms.api.my_api.create_purchase_receipt",t);console.log("ddddddd",e.data),ae=!0;const l=e.data.message;D.value=l,console.log("nameee",l),alert(`purchase receipt created ${e.data.message}`||e.data._server_messages),l&&document.getElementById("DraftReceipt").addEventListener("click",()=>p(this,null,function*(){yield oe(l)}))}catch(a){console.error("Error creating purchase receipt:",a),alert("error while creating purchase receipt",a.Error)}});console.log("draftNum",we);const oe=a=>p(this,null,function*(){try{if(se)throw new Error("Purchase receipt has already been created for this data");const t=_.value;if(!t){console.error("Purchase order name is undefined");return}const e={name:t,pr:u.value,items:f.value.map(F=>({item_code:F.itemCode,warehouse:F.warehouse,qty:parseInt(F.quantity),uom:F.uom}))};a&&!(a instanceof PointerEvent)&&(e.pr=a),console.log("Request Data:",e);const l=yield S.post("/api/method/wms.api.my_api.submit_and_create_purchase_receipt",e);console.log("Purchase receipt created:",l.data);const y=JSON.parse(l.data._server_messages),z=JSON.parse(y[0]);alert(z.message),se=!0,D.value=l.data.message}catch(t){console.error("Error creating or submitting purchase receipt:",t.response),alert("You can not create purchase receipt you need to do quality inspection or check the data you entered",t.response)}}),R=o(!1),E=o(""),re=()=>{R.value=!0;const a=new Html5Qrcode("reader");a.start({facingMode:"environment"},t=>{console.log("QR code scanned:",t),alert("QR code scanned: "+t),le(E.value),ne(a)},t=>{E.value=t,alert(" QR code: "+E.value),le(E.value),ne(a)})},ne=a=>{R.value=!1,a.stop()},B=o(""),le=a=>p(this,null,function*(){try{const t=yield fetch(`/api/method/wms.api.my_api.item_match_with_qr?barcode=${a}`);if(!t.ok)throw new Error("Network response was not ok");const e=yield t.json();return B.value=e.message.parent,console.log("dat returned :",e.message.parent),e}catch(t){return console.error("Error fetching item details:",t),null}}),xe=ce(()=>{const a=new Set;return I.value.filter(t=>{const e=a.has(t.name);return a.add(t.name),!e})});ce(()=>xe.value.some(a=>a.name===B.value)),Ne(()=>{B.value&&(d.value=B.value),q.value=E.value}),console.log("linkName",u);const Q=o([]),Ce=()=>p(this,null,function*(){try{const a=yield S.get("/api/method/wms.api.my_api.get_purchase_receipt",{params:{receipt_name:u.value}});Q.value=a.data.message,console.log("apiData",Q.value),Q.value?(D.value=Q.value.name,Q.value.items.forEach(t=>{_.value=t.purchase_order,f.value.push({itemCode:t.item_code,warehouse:t.warehouse,quantity:t.qty})})):console.error("Invalid response data:",a.data)}catch(a){console.log("Error while fetching data",a.response)}});Pe(()=>{O.query.linkName&&Ce()});const ke=o(""),qe=()=>p(this,null,function*(){try{const a={docname:D.value||u.value,items:f.value.map(e=>({item_code:e.itemCode,warehouse:e.warehouse,qty:parseInt(e.quantity),uom:e.uom,sample_size:0}))};console.log("quality data:",a);const t=yield S.post("/api/method/wms.api.my_api.save_quality_inspections",a);console.log("quality created:",t.data.message[0]),ke.value=t.data.message[0],alert(`quality inspection saved in draft ${t.data.message.name}`)}catch(a){console.error("Error creating quality inspection:",a),alert("Error while creating quality inspection:",a.message),window.location.href="/ReceivePage"}});return(a,t)=>(r(),H(Le,{pageTitle:c(D),home:"shopping-cart",onCartIconClick:pe,class:"text-xs"},{body:J(()=>[s("div",$e,[s("div",{onClick:w,id:"purchaseDate",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},[Ae,s("div",Be,[s("div",{class:"custom-select",onClick:ye},[s("div",Fe,[s("div",Ve,[h(c(g),{name:"chevron-down",class:"h-5 w-5 text-gray-500 cursor-pointer ml-auto"}),s("div",Me,n(_.value),1)])]),s("div",Ue,[s("div",je,[L(s("input",{type:"text",placeholder:"Type here...",onClick:t[0]||(t[0]=Se(()=>{},["stop"])),onInput:t[1]||(t[1]=e=>fe(e.target.value)),"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e),id:"searchPurchaseOrder"},null,544),[[V,_.value]])]),_.value?(r(),i("div",Je,[(r(!0),i(b,null,x(A.value,e=>(r(),i("div",{key:e.name,class:"custom-option",onClick:l=>ee(e.name)},[s("p",null,n(e.name),1),s("p",Ye,[G(n(e.supplier)+", ",1),s("span",null,n(e.company),1)])],8,Ge))),128))])):(r(),i("div",ze,[(r(!0),i(b,null,x(N.value,e=>(r(),i("div",{key:e.name,class:"custom-option",onClick:l=>ee(e.name)},[s("p",null,n(e.name),1),s("p",He,[G(n(e.supplier)+", ",1),s("span",null,n(e.company),1)])],8,We))),128))]))])])])]),s("div",Ke,[Xe,h(c(g),{name:"plus",class:"h-6 w-6 text-black-500 cursor-pointer",onClick:k})]),s("div",Ze,[s("div",et,[(r(!0),i(b,null,x(f.value,(e,l)=>(r(),i("div",{id:"basedOnActiveTabs",class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:l},[s("div",tt,[h(c(g),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),s("div",at,[s("p",null,n(e.purchaseOrder),1),s("p",null,n(e.itemCode)+" | "+n(e.warehouse),1)]),s("div",st,n(e.quantity),1)]),h(c(g),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),L(s("div",ot,null,512),[[Oe,R.value]]),C.value?(r(),i("div",rt,[s("div",{onClick:w,id:"space"},[s("div",{onClick:w,id:"scrollerLine"})]),nt,lt,s("div",it,[L(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.value=e),placeholder:"Search item name here",list:"searchName",id:"nameField"},null,512),[[V,d.value]]),s("datalist",ct,[(r(!0),i(b,null,x(I.value,e=>(r(),i("option",{key:e.title,value:e.name},n(e.item_code),9,ut))),128))]),G(),s("span",{class:"barcode-scanner",id:"QRcodescanner",onClick:re},[h(c(g),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),dt,pt,s("div",mt,[L(s("input",{placeholder:"Search item by warehouse",list:"searchWarehouse",id:"wareHouseName","onUpdate:modelValue":t[4]||(t[4]=e=>q.value=e)},null,512),[[V,q.value]]),s("datalist",ht,[(r(!0),i(b,null,x(X.value,e=>(r(),i("option",{key:e,value:e},n(e),9,vt))),128))]),s("span",{class:"barcode-scanner",onClick:re},[h(c(g),{name:"maximize",class:"h-6 w-6 text-black-500"})])]),_t,ft,L(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>m.value=e),type:"number",id:"quantity",placeholder:"change quantity"},null,512),[[V,m.value]]),yt,s("button",{id:"addNew",onClick:ve},"Submit and Add New"),gt,s("button",{id:"sub",onClick:_e},"Submit ")])):ue("",!0),$.value?(r(),i("div",{key:1,class:"barcode-scanner-container",onClick:v},bt)):ue("",!0),s("div",xt,[s("div",Ct,[(r(!0),i(b,null,x(a.submittedData,e=>(r(),i("div",{class:"flex flex-row flex-start p-4 items-center justify-between border-b",key:e.title},[s("div",kt,[(r(),H(de(e.icon),{class:"h-5 w-5 text-gray-500"})),h(c(g),{name:"shopping-cart",class:"h-5 w-5 text-gray-500"}),s("div",qt,[s("p",null,n(e.purchaseOrder),1),s("p",null,n(e.itemCode)+"| "+n(e.warehouse),1)]),s("div",It,n(e.uom),1)]),h(c(g),{name:"chevron-right",class:"h-5 w-5 text-gray-500"})]))),128))])]),s("div",{id:"btnDiv",class:"text-base leading-6 rounded w-full py-6 px-4 border-none"},[s("button",{id:"submitPurchaseReceipt",onClick:oe},"Submit"),s("button",{id:"savePurchaseReceipt",onClick:be},"Save")]),Nt]),h(c(Ee),{slot:"bottom",class:"bg-white shadow-md sm:w-96 py-2 standalone:pb-safe-bottom"},{default:J(()=>[(r(),i(b,null,x(M,e=>h(c(Re),{key:e.title,tab:e.title,href:e.route,onClick:l=>T(e),class:De(["bg-white text-xs space-y-1.5 !hover:border-gray-300 !hover:text-gray-700 transition active:scale-95",c(O).path===e.route?"border-gray-900 text-gray-800 font-semibold":"text-gray-600 font-normal"])},{default:J(()=>[(r(),H(de(e.icon),{class:"h-5 w-5"})),s("div",null,n(e.title),1)]),_:2},1032,["tab","href","onClick","class"])),64))]),_:1})]),_:1},8,["pageTitle"]))}};export{jt as default};
